<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>后台管理系统 - 文创邦</title>
    <link rel="stylesheet" href="admin-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* 覆盖收益管理顶部任务切换的样式（提高优先级） */
        #earnings .task-tabs{display:flex;gap:8px;margin-bottom:16px;padding:8px;background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 6px 18px rgba(17,24,39,.04)}
        #earnings .task-tab{display:flex;align-items:center;gap:8px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:999px;padding:10px 16px;font-size:14px;color:#374151;cursor:pointer;transition:all .2s ease}
        #earnings .task-tab:hover{background:#f3f4f6;transform:translateY(-1px)}
        #earnings .task-tab.active{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;border-color:transparent;box-shadow:0 8px 20px rgba(99,102,241,.22)}
        #earnings .task-tab i{font-size:14px;opacity:.9}
        /* 强制任务标签横向排列并按内容宽度展示 */
        #earnings #taskEarningsSection.task-tabs{flex-direction:row;flex-wrap:nowrap;align-items:center}
        #earnings #taskEarningsSection .task-tab{flex:0 0 auto;display:inline-flex}
        /* 收益类别一级切换 */
        #earnings .section-tabs{display:flex;gap:8px;margin:10px 0 12px 0}
        #earnings .section-tab{display:flex;align-items:center;gap:8px;background:#f8fafc;border:1px solid #e5e7eb;border-radius:8px;padding:8px 12px;font-size:14px;color:#374151;cursor:pointer;transition:all .2s ease}
        #earnings .section-tab:hover{background:#f3f4f6}
        #earnings .section-tab.active{background:#111827;color:#fff;border-color:#111827}
        /* 表格密度（系统设置开关） */
        body.dense-tables .data-table th,
        body.dense-tables .data-table td{padding:6px 10px}
        /* 维护模式顶栏提示 */
        .maintenance-banner{display:none;position:fixed;top:0;left:0;right:0;height:36px;line-height:36px;background:#fef3c7;color:#92400e;text-align:center;font-size:14px;z-index:1000;border-bottom:1px solid #f59e0b}
        body.maintenance .maintenance-banner{display:block}

        /* 仪表盘紧凑列表卡片样式（缩小尺寸） */
        .compact-list,.recent-users,.recent-earnings,.pending-withdrawals{display:flex;flex-direction:column;gap:8px}
        .recent-item{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border:1px solid #e5e7eb;border-radius:10px;background:linear-gradient(135deg,#f8fafc,#ffffff);box-shadow:0 3px 8px rgba(17,24,39,.03)}
        .recent-item-info{display:flex;align-items:center;gap:8px}
        .recent-item-avatar{width:30px;height:30px;border-radius:8px;background:#6366f1;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px}
        .recent-item-details h4{margin:0;font-size:13px;color:#111827}
        .recent-item-details p{margin:1px 0 0;color:#6b7280;font-size:11px}
        .recent-item-value{font-weight:700;color:#111827;font-size:13px}
        .recent-item .status-badge{padding:3px 8px;border-radius:9999px;background:#ecfeff;color:#155e75;font-weight:600;font-size:11px}

        /* 任务卡片图标（与前台一致的图片） */
        .task-pill .tp-img{width:24px;height:24px;border-radius:6px;object-fit:cover;margin-right:10px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    </style>
</head>
<body>
    <div class="maintenance-banner">⚠ 当前处于维护模式，部分功能暂不可用</div>
    <div class="admin-container">
        <!-- 侧边栏 -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-crown"></i>
                <span>管理后台</span>
            </div>
            
            <nav class="nav-menu">
                <ul>
                    <li class="nav-item active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>仪表盘</span>
                    </li>
                    <li class="nav-item" data-page="users">
                        <i class="fas fa-users"></i>
                        <span>用户管理</span>
                    </li>
                    <li class="nav-item" data-page="earnings">
                        <i class="fas fa-coins"></i>
                        <span>收益管理</span>
                    </li>
                    <li class="nav-item" data-page="withdrawals">
                        <i class="fas fa-money-check-alt"></i>
                        <span>提现审核</span>
                    </li>
                    <li class="nav-item" data-page="tasks">
                        <i class="fas fa-tasks"></i>
                        <span>任务管理</span>
                    </li>
                    <li class="nav-item" data-page="analytics">
                        <i class="fas fa-chart-bar"></i>
                        <span>数据分析</span>
                    </li>
                    <li class="nav-item" data-page="leaders">
                        <i class="fas fa-user-friends"></i>
                        <span>团长管理</span>
                    </li>
                    <li class="nav-item" data-page="announcements">
                        <i class="fas fa-bullhorn"></i>
                        <span>公告管理</span>
                    </li>
                    <li class="nav-item" data-page="settings">
                        <i class="fas fa-cog"></i>
                        <span>系统设置</span>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 顶部导航 -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 class="page-title">仪表盘</h1>
                </div>
                <div class="header-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="搜索..." id="globalSearch">
                    </div>
                    <div class="user-menu">
                        <button class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                            <span>管理员</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- 页面内容 -->
            <div class="content">
                <!-- 仪表盘页面 -->
                <div id="dashboard" class="page active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon users">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalUsers">-</h3>
                                <p>总用户数</p>
                                <div class="stat-delta" id="totalUsersDelta"></div>
                                <canvas class="sparkline" id="sparkUsers"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon earnings">
                                <i class="fas fa-coins"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="totalEarnings">-</h3>
                        <p>总收益 <button id="resetTotalEarningsBtn" style="background:none;border:none;color:#6366f1;font-size:12px;cursor:pointer;margin-left:6px;">重置</button></p>
                                <div class="stat-delta" id="totalEarningsDelta"></div>
                                <canvas class="sparkline" id="sparkEarnings"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon withdrawals">
                                <i class="fas fa-money-check-alt"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="pendingWithdrawals">-</h3>
                                <p>待审核提现</p>
                                <div class="stat-delta" id="pendingWithdrawalsDelta"></div>
                                <canvas class="sparkline" id="sparkWithdrawals"></canvas>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon tasks">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="stat-info">
                                <h3 id="activeTasks">-</h3>
                                <p>活跃任务</p>
                                <div class="stat-delta" id="activeTasksDelta"></div>
                                <canvas class="sparkline" id="sparkTasks"></canvas>
                            </div>
                        </div>
                <div class="stat-card">
                    <div class="stat-icon earnings">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="todayEarnings">-</h3>
                        <p>今日收益</p>
                        <div class="stat-delta" id="todayEarningsDelta"></div>
                        <canvas class="sparkline" id="sparkToday"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon earnings">
                        <i class="fas fa-calendar-week"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="weekEarnings">-</h3>
                        <p>本周收益</p>
                        <div class="stat-delta" id="weekEarningsDelta"></div>
                        <canvas class="sparkline" id="sparkWeek"></canvas>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon earnings">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="monthEarnings">-</h3>
                        <p>本月收益</p>
                        <div class="stat-delta" id="monthEarningsDelta"></div>
                        <canvas class="sparkline" id="sparkMonth"></canvas>
                    </div>
                </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="card">
                            <div class="card-header">
                                <h3>最近用户</h3>
                                <a href="#" onclick="showPage('users')" class="view-all">查看全部</a>
                            </div>
                            <div class="card-body">
                                <div class="recent-users" id="recentUsers">
                                    <div class="loading">加载中...</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>最近收益</h3>
                                <a href="#" onclick="showPage('earnings')" class="view-all">查看全部</a>
                            </div>
                            <div class="card-body">
                                <div class="recent-earnings" id="recentEarnings">
                                    <div class="loading">加载中...</div>
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>待处理提现</h3>
                                <a href="#" onclick="showPage('withdrawals')" class="view-all">查看全部</a>
                            </div>
                            <div class="card-body">
                                <div class="pending-withdrawals" id="pendingWithdrawalsList">
                                    <div class="loading">加载中...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 团长管理页面 -->
                <div id="leaders" class="page">
                    <style>
                        #leaders .leader-metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0}
                        #leaders .metric{background:linear-gradient(135deg,#f5f7ff,#ffffff);border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;box-shadow:0 4px 12px rgba(17,24,39,.04)}
                        #leaders .metric-val{font-size:20px;font-weight:700;color:#111827}
                        #leaders .metric-label{font-size:12px;color:#6b7280;margin-top:4px}
                        #leaders .leader-status{display:inline-block;padding:4px 10px;border-radius:9999px;font-size:12px;font-weight:600}
                        #leaders .leader-status.on{background:#dcfce7;color:#166534}
                        #leaders .leader-status.off{background:#fee2e2;color:#991b1b}
                        #leaders .data-table thead th{position:sticky;top:0;background:#fff;z-index:1}
                        #leaders .data-table tbody tr:hover{background:#f9fafb}
                    </style>
                    <div class="page-header">
                        <h2>团长管理</h2>
                        <div class="page-actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                            <input id="addLeaderInput" class="search-input" placeholder="输入用户名 添加为团长（支持模糊搜索）">
                            <button class="btn btn-primary" onclick="addLeaderFromInput()"><i class="fas fa-user-plus"></i> 添加团长</button>
                            <button class="btn" onclick="loadLeadersAllowlist()"><i class="fas fa-sync"></i> 刷新</button>
                            <button class="btn btn-warning" onclick="triggerLeadersTableCreate()"><i class="fas fa-wrench"></i> 创建表</button>
                        </div>
                    </div>
                    <div class="leader-metrics">
                        <div class="metric"><div class="metric-val" id="lmTotal">--</div><div class="metric-label">团长总数</div></div>
                        <div class="metric"><div class="metric-val" id="lmEnabled">--</div><div class="metric-label">已启用</div></div>
                        <div class="metric"><div class="metric-val" id="lmDisabled">--</div><div class="metric-label">已禁用</div></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>团长白名单（可邀请权限）</h3></div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="leadersAllowlistTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>用户ID</th>
                                            <th>用户名</th>
                                            <th>短码</th>
                                            <th>添加时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td colspan="7" class="loading">加载中...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="margin-top:16px;">
                        <div class="card-header"><h3>邀请数据统计</h3></div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="leadersTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>团长</th>
                                            <th>一级成员数</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td colspan="4" class="loading">加载中...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 用户管理页面 -->
                <div id="users" class="page">
                    <style>
                        #users .user-metrics{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:12px 0 6px 0}
                        #users .metric{background:linear-gradient(135deg,#f5f7ff,#ffffff);border:1px solid #e5e7eb;border-radius:12px;padding:14px 16px;box-shadow:0 4px 12px rgba(17,24,39,.04)}
                        #users .metric-val{font-size:20px;font-weight:700;color:#111827}
                        #users .metric-label{font-size:12px;color:#6b7280;margin-top:4px}
                        #users .data-table thead th{position:sticky;top:0;background:#fff;z-index:1}
                        #users .data-table tbody tr{transition:background .18s ease, box-shadow .18s ease}
                        #users .data-table tbody tr:hover{background:#f9fafb}
                        #users .user-avatar{width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;font-weight:700}
                        #users .search-input{min-width:280px}
                    </style>
                    <div class="page-header">
                        <h2>用户管理</h2>
                        <div class="page-actions">
                            <button class="btn btn-primary" onclick="openUserModal()">
                                <i class="fas fa-plus"></i> 添加用户
                            </button>
                        </div>
                    </div>
                    <div class="user-metrics">
                        <div class="metric"><div class="metric-val" id="umTotal">--</div><div class="metric-label">用户总数</div></div>
                        <div class="metric"><div class="metric-val" id="umToday">--</div><div class="metric-label">今日新增</div></div>
                        <div class="metric"><div class="metric-val" id="umActive">--</div><div class="metric-label">正常状态</div></div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3>用户列表</h3>
                            <div class="search-filters" id="userToolbar">
                                <input type="text" placeholder="搜索ID/用户名/邮箱..." id="userSearch" class="search-input" oninput="userFiltersChanged()">
                                <select id="userStatusFilter" class="filter-select" onchange="applyUserFilters()">
                                    <option value="">全部状态</option>
                                    <option value="active">正常</option>
                                    <option value="disabled">禁用</option>
                                </select>
                                <select id="userDateRange" class="filter-select" onchange="applyUserFilters()">
                                    <option value="">注册时间: 全部</option>
                                    <option value="1">近1天</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyUserFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="bulkEnableUsers()">批量启用</button>
                                <button class="btn btn-warning" onclick="bulkDisableUsers()">批量禁用</button>
                                <button class="btn btn-error" onclick="bulkDeleteUsers()">批量删除</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="usersTable">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" id="userSelectAll" onclick="toggleSelectAll()"></th>
                                            <th>ID</th>
                                            <th>头像</th>
                                            <th>用户名</th>
                                            <th>邮箱</th>
                                            <th>注册时间</th>
                                            <th>积分</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="8" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 收益管理页面 -->
                <div id="earnings" class="page">
                    <div class="page-header">
                        <h2>收益管理</h2>
                    <div class="page-actions">
                        <button id="btnAddEarning" class="btn btn-primary" style="display:none" onclick="openEarningsModal()">
                            <i class="fas fa-plus"></i> 添加收益
                        </button>
                    </div>
                    </div>

                    <!-- 一级切换：任务收益 / 其他收益 -->
                    <div class="section-tabs">
                        <button class="section-tab active" data-section="task" onclick="switchEarningsSection('task')"><i class="fas fa-briefcase"></i> 任务收益管理</button>
                        <button class="section-tab" data-section="other" onclick="switchEarningsSection('other')" id="otherEarningsTab"><i class="fas fa-gift"></i> 其他收益管理</button>
                    </div>
                    
                    <!-- 任务分类选项卡（任务收益管理内部） -->
                    <div class="task-tabs earnings-section" id="taskEarningsSection">
                        <button class="task-tab active" data-task="all" onclick="switchTaskTab('all')">
                            <i class="fas fa-list"></i> 全部收益
                        </button>
                        <button class="task-tab" data-task="kk-search" onclick="switchTaskTab('kk-search')">
                            <i class="fas fa-search"></i> KK搜索
                        </button>
                        <button class="task-tab" data-task="wukong-search" onclick="switchTaskTab('wukong-search')">
                            <i class="fas fa-magic"></i> w空搜索
                        </button>
                        <button class="task-tab" data-task="xray-search" onclick="switchTaskTab('xray-search')">
                            <i class="fas fa-browser"></i> x雷浏览器
                        </button>
                        <button class="task-tab" data-task="kk-disk" onclick="switchTaskTab('kk-disk')">
                            <i class="fas fa-cloud"></i> KK网盘
                        </button>
                    </div>
                    
                    <!-- 全部收益列表（任务收益管理内部） -->
                    <div class="card task-content" id="allEarnings">
                        <div class="card-header">
                            <h3>全部收益列表</h3>
                            <div class="search-filters" id="earningsToolbar">
                                <input type="text" placeholder="搜索ID/用户/类型..." id="earningsSearch" class="search-input" oninput="earningsFiltersChanged()">
                                <select id="earningsTypeFilter" class="filter-select" onchange="applyEarningsFilters()">
                                    <option value="">全部类型</option>
                                    <option value="KK搜索任务">KK搜索任务</option>
                                    <option value="悟空搜索任务">悟空搜索任务</option>
                                    <option value="KK网盘任务">KK网盘任务</option>
                                    <option value="签到奖励">签到奖励</option>
                                </select>
                                <select id="earningsStatusFilter" class="filter-select" onchange="applyEarningsFilters()">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                                <select id="earningsDateRange" class="filter-select" onchange="applyEarningsFilters()">
                                    <option value="">时间: 全部</option>
                                    <option value="1">近1天</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyEarningsFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportEarningsCSV()">导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="earningsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>任务类型</th>
                                            <th>金额 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortEarningsBy('amount')"></i></th>
                                            <th>时间 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortEarningsBy('created_at')"></i></th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 其他收益管理（移动到任务区域之后，确保可见） -->
                    <div class="earnings-section" id="otherEarningsSection" style="display:none;">
                        <!-- 统计卡片 -->
                        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-bottom:20px;">
                            <div style="background:linear-gradient(135deg,#10b981,#34d399);border-radius:16px;padding:24px;color:white;box-shadow:0 4px 12px rgba(16,185,129,0.3);">
                                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                                    <i class="fas fa-gift" style="font-size:28px;opacity:0.9;"></i>
                                    <span style="font-size:14px;opacity:0.9;">活动收益总额</span>
                                </div>
                                <div style="font-size:32px;font-weight:700;" id="activityEarningsTotal">¥0.00</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#8b5cf6,#a78bfa);border-radius:16px;padding:24px;color:white;box-shadow:0 4px 12px rgba(139,92,246,0.3);">
                                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                                    <i class="fas fa-crown" style="font-size:28px;opacity:0.9;"></i>
                                    <span style="font-size:14px;opacity:0.9;">团队收益总额</span>
                                </div>
                                <div style="font-size:32px;font-weight:700;" id="leaderEarningsTotal">¥0.00</div>
                            </div>
                            <div style="background:linear-gradient(135deg,#f59e0b,#fbbf24);border-radius:16px;padding:24px;color:white;box-shadow:0 4px 12px rgba(245,158,11,0.3);">
                                <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px;">
                                    <i class="fas fa-coins" style="font-size:28px;opacity:0.9;"></i>
                                    <span style="font-size:14px;opacity:0.9;">其他收益总额</span>
                                </div>
                                <div style="font-size:32px;font-weight:700;" id="otherEarningsTotal">¥0.00</div>
                            </div>
                        </div>
                        
                        <!-- 分类标签页 -->
                        <div style="display:flex;gap:8px;margin-bottom:16px;border-bottom:2px solid #e5e7eb;">
                            <button class="other-type-tab active" data-type="activity" onclick="switchOtherTypeTab('activity')" style="flex:1;padding:12px 20px;background:transparent;border:none;border-bottom:3px solid #10b981;color:#10b981;font-weight:600;cursor:pointer;transition:all 0.3s;">
                                <i class="fas fa-gift"></i> 活动收益
                            </button>
                            <button class="other-type-tab" data-type="leader" onclick="switchOtherTypeTab('leader')" style="flex:1;padding:12px 20px;background:transparent;border:none;border-bottom:3px solid transparent;color:#6b7280;font-weight:600;cursor:pointer;transition:all 0.3s;">
                                <i class="fas fa-crown"></i> 团队收益
                            </button>
                            <button class="other-type-tab" data-type="other" onclick="switchOtherTypeTab('other')" style="flex:1;padding:12px 20px;background:transparent;border:none;border-bottom:3px solid transparent;color:#6b7280;font-weight:600;cursor:pointer;transition:all 0.3s;">
                                <i class="fas fa-coins"></i> 其他收益
                            </button>
                        </div>
                        
                        <!-- 活动收益列表 -->
                        <div class="card other-type-content" id="activityEarningsContent">
                        <div class="card-header">
                                <h3>活动收益管理</h3>
                                <button class="btn btn-success" onclick="openOtherEarningModal('活动收益')"><i class="fas fa-plus"></i> 添加活动收益</button>
                        </div>
                        <div class="card-body">
                            <div class="search-filters">
                                    <input type="text" placeholder="搜索用户/ID..." id="activityEarningsSearch" class="search-input" oninput="filterOtherEarnings('activity')">
                                    <select id="activityEarningsStatusFilter" class="filter-select" onchange="filterOtherEarnings('activity')">
                                        <option value="">全部状态</option>
                                        <option value="已完成">已完成</option>
                                        <option value="进行中">进行中</option>
                                        <option value="已取消">已取消</option>
                                </select>
                                </div>
                                <div class="table-container">
                                    <table class="data-table" id="activityEarningsTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用户</th>
                                                <th>活动名称</th>
                                                <th>金额</th>
                                                <th>时间</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td colspan="7" class="loading">加载中...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 团队收益列表 -->
                        <div class="card other-type-content" id="leaderEarningsContent" style="display:none;">
                            <div class="card-header">
                                <h3>团队收益管理</h3>
                                <button class="btn btn-warning" onclick="openOtherEarningModal('团长收益')"><i class="fas fa-plus"></i> 添加团队收益</button>
                            </div>
                            <div class="card-body">
                                <div class="search-filters">
                                    <input type="text" placeholder="搜索用户/ID..." id="leaderEarningsSearch" class="search-input" oninput="filterOtherEarnings('leader')">
                                    <select id="leaderEarningsStatusFilter" class="filter-select" onchange="filterOtherEarnings('leader')">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                            </div>
                            <div class="table-container">
                                    <table class="data-table" id="leaderEarningsTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户</th>
                                                <th>来源</th>
                                            <th>金额</th>
                                            <th>时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td colspan="7" class="loading">加载中...</td></tr>
                                    </tbody>
                                </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 其他收益列表 -->
                        <div class="card other-type-content" id="otherEarningsContent" style="display:none;">
                            <div class="card-header">
                                <h3>其他收益管理</h3>
                                <button class="btn btn-primary" onclick="openOtherEarningModal('其他收益')"><i class="fas fa-plus"></i> 添加其他收益</button>
                            </div>
                            <div class="card-body">
                                <div class="search-filters">
                                    <input type="text" placeholder="搜索用户/ID..." id="otherTypeEarningsSearch" class="search-input" oninput="filterOtherEarnings('other')">
                                    <select id="otherTypeEarningsStatusFilter" class="filter-select" onchange="filterOtherEarnings('other')">
                                        <option value="">全部状态</option>
                                        <option value="已完成">已完成</option>
                                        <option value="进行中">进行中</option>
                                        <option value="已取消">已取消</option>
                                    </select>
                                </div>
                                <div class="table-container">
                                    <table class="data-table" id="otherTypeEarningsTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用户</th>
                                                <th>说明</th>
                                                <th>金额</th>
                                                <th>时间</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr><td colspan="7" class="loading">加载中...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- KK搜索任务列表 -->
                    <div class="card task-content" id="kkSearchEarnings" style="display: none;">
                        <div class="card-header">
                            <h3>KK搜索任务记录</h3>
                            <div class="search-filters" id="kkToolbar">
                                <input type="text" placeholder="搜索ID/用户/类型..." id="kkSearchSearch" class="search-input">
                                <select id="kkSearchStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                                <select id="kkSearchDateRange" class="filter-select">
                                    <option value="">时间: 全部</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyKKEarningsFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportKKEarningsCSV()">导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="kkSearchTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>申请关键词</th>
                                            <th>推广经验</th>
                                            <th>推广渠道</th>
                                            <th>金额</th>
                                            <th>申请时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 悟空搜索任务列表 -->
                    <div class="card task-content" id="wukongSearchEarnings" style="display: none;">
                        <div class="card-header">
                            <h3>w空搜索任务记录</h3>
                            <div class="search-filters" id="wkToolbar">
                                <input type="text" placeholder="搜索ID/用户/类型..." id="wukongSearchSearch" class="search-input">
                                <select id="wukongSearchStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                                <select id="wukongSearchDateRange" class="filter-select">
                                    <option value="">时间: 全部</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyWKEarningsFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportWKEarningsCSV()">导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="wukongSearchTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>申请关键词</th>
                                            <th>推广经验</th>
                                            <th>推广渠道</th>
                                            <th>金额</th>
                                            <th>申请时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="10" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- x雷浏览器任务列表 -->
                    <div class="card task-content" id="xraySearchEarnings" style="display: none;">
                        <div class="card-header">
                            <h3>x雷浏览器任务记录</h3>
                            <div class="search-filters" id="xrayToolbar">
                                <input type="text" placeholder="搜索ID/用户/类型..." id="xraySearchSearch" class="search-input">
                                <select id="xraySearchStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                                <select id="xraySearchDateRange" class="filter-select">
                                    <option value="">时间: 全部</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyXrayEarningsFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportXrayEarningsCSV()">导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="xraySearchTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>任务类型</th>
                                            <th>金额 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortXRBy('amount')"></i></th>
                                            <th>时间 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortXRBy('created_at')"></i></th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- KK网盘任务列表 -->
                    <div class="card task-content" id="kkDiskEarnings" style="display: none;">
                        <div class="card-header">
                            <h3>KK网盘任务记录</h3>
                            <div class="search-filters" id="kdToolbar">
                                <input type="text" placeholder="搜索ID/用户/类型..." id="kkDiskSearch" class="search-input">
                                <select id="kkDiskStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="已完成">已完成</option>
                                    <option value="进行中">进行中</option>
                                    <option value="已取消">已取消</option>
                                </select>
                                <select id="kkDiskDateRange" class="filter-select">
                                    <option value="">时间: 全部</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <button class="btn" onclick="applyKDEarningsFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportKDEarningsCSV()">导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="kkDiskTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>申请关键词</th>
                                            <th>推广经验</th>
                                            <th>推广渠道</th>
                                            <th>金额</th>
                                            <th>申请时间</th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 提现审核页面 -->
                <div id="withdrawals" class="page">
                    <div class="page-header">
                        <h2>提现审核</h2>
                        <div class="page-actions">
                            
                            <div class="filter-tabs">
                                <button class="filter-tab active" data-filter="all">全部</button>
                                <button class="filter-tab" data-filter="pending">待审核</button>
                                <button class="filter-tab" data-filter="approved">已通过</button>
                                <button class="filter-tab" data-filter="rejected">已拒绝</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <div class="search-filters" id="withdrawalsToolbar" style="margin-bottom:12px;">
                                <input type="text" placeholder="搜索ID/用户..." id="withdrawalSearch" class="search-input" oninput="withdrawalFiltersChanged()">
                                <select id="withdrawalMethodFilter" class="filter-select" onchange="applyWithdrawalFilters()">
                                    <option value="">全部方式</option>
                                    <option value="alipay">支付宝</option>
                                    <option value="wechat">微信</option>
                                </select>
                                <select id="withdrawalDateRange" class="filter-select" onchange="applyWithdrawalFilters()">
                                    <option value="">时间: 全部</option>
                                    <option value="1">近1天</option>
                                    <option value="7">近7天</option>
                                    <option value="30">近30天</option>
                                </select>
                                <input type="number" placeholder="最小金额" id="withdrawalAmountMin" class="search-input" style="max-width:120px;" oninput="withdrawalFiltersChanged()">
                                <input type="number" placeholder="最大金额" id="withdrawalAmountMax" class="search-input" style="max-width:120px;" oninput="withdrawalFiltersChanged()">
                                <button class="btn" onclick="applyWithdrawalFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-secondary" onclick="exportWithdrawalsCSV()">导出CSV</button>
                                <button class="btn btn-success" style="margin-left:8px;" onclick="bulkApproveWithdrawals()">批量通过</button>
                                <button class="btn btn-error" style="margin-left:8px;" onclick="bulkRejectWithdrawals()">批量拒绝</button>
                            </div>
                            <div class="table-container">
                                <table class="data-table" id="withdrawalsTable">
                                    <thead>
                                        <tr>
                                            <th><input type="checkbox" id="withdrawalSelectAll" onclick="toggleSelectAllWithdrawals()"></th>
                                            <th>ID</th>
                                            <th>用户</th>
                                            <th>提现方式</th>
                                            <th>金额 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortWithdrawalsBy('amount')"></i></th>
                                            <th>申请时间 <i class="fas fa-sort" style="margin-left:6px;cursor:pointer" onclick="sortWithdrawalsBy('created_at')"></i></th>
                                            <th>状态</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="7" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 任务管理页面 -->
                <div id="tasks" class="page">
                    <div class="page-header">
                        <h2>任务管理</h2>
                        <div class="page-actions">
                            <div class="status-stats">
                                <span class="stat-item">
                                    <i class="fas fa-clock text-warning"></i>
                                    待审核: <strong id="pendingCount">0</strong>
                                </span>
                                <span class="stat-item">
                                    <i class="fas fa-check text-success"></i>
                                    已通过: <strong id="approvedCount">0</strong>
                                </span>
                                <span class="stat-item">
                                    <i class="fas fa-times text-error"></i>
                                    已拒绝: <strong id="rejectedCount">0</strong>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 任务快速选择（更美观的项目卡片） -->
                    <div class="task-selector">
                        <div class="task-pill active" data-task="kk-search" onclick="switchTaskManagementTab('kk-search');highlightTaskPill(this)">
                            <img class="tp-img" src="tp/微信图片_20250913162419.jpg" alt="KK">
                            <div>
                                <div class="tp-title">KK搜索</div>
                                <div class="tp-sub">关键词审核 · 仓库 · 收益 · 配置</div>
                                <div class="tp-badges">
                                    <span class="tp-badge pending" id="pill-kk-pending">0</span>
                                    <span class="tp-badge approved" id="pill-kk-approved">0</span>
                                    <span class="tp-badge rejected" id="pill-kk-rejected">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-pill" data-task="xray-search" onclick="switchTaskManagementTab('xray-search');highlightTaskPill(this)">
                            <img class="tp-img" src="tp/2749C5F09D24C60CB377B64D4F1FD00F.jpg" alt="xray">
                            <div>
                                <div class="tp-title">x雷浏览器</div>
                                <div class="tp-sub">关键词审核 · 仓库 · 收益 · 配置</div>
                                <div class="tp-badges">
                                    <span class="tp-badge pending" id="pill-xr-pending">0</span>
                                    <span class="tp-badge approved" id="pill-xr-approved">0</span>
                                    <span class="tp-badge rejected" id="pill-xr-rejected">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-pill" data-task="wukong-search" onclick="switchTaskManagementTab('wukong-search');highlightTaskPill(this)">
                            <img class="tp-img" src="tp/F3673981D160E851966CAE341C0B8350.jpg" alt="WK">
                            <div>
                                <div class="tp-title">w空搜索</div>
                                <div class="tp-sub">审核与配置</div>
                                <div class="tp-badges">
                                    <span class="tp-badge pending" id="pill-wk-pending">0</span>
                                    <span class="tp-badge approved" id="pill-wk-approved">0</span>
                                    <span class="tp-badge rejected" id="pill-wk-rejected">0</span>
                                </div>
                            </div>
                        </div>
                        <div class="task-pill" data-task="kk-disk" onclick="switchTaskManagementTab('kk-disk');highlightTaskPill(this)">
                            <i class="fas fa-cloud"></i>
                            <div>
                                <div class="tp-title">KK网盘</div>
                                <div class="tp-sub">审核与配置</div>
                                <div class="tp-badges">
                                    <span class="tp-badge pending" id="pill-kd-pending">0</span>
                                    <span class="tp-badge approved" id="pill-kd-approved">0</span>
                                    <span class="tp-badge rejected" id="pill-kd-rejected">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- KK搜索 任务中心（子页签） -->
                    <div class="card task-management-content" id="kkSearchManagement">
                        <div class="card-header">
                            <h3>KK搜索 · 任务中心</h3>
                            <div class="search-filters" style="gap:8px;">
                                <button class="btn btn-primary" onclick="switchTaskSubTab('kk','review')">申请审核</button>
                                <button class="btn" onclick="switchTaskSubTab('kk','repo')">关键词仓库</button>
                                <button class="btn" onclick="switchTaskSubTab('kk','earnings')">收益记录</button>
                                <button class="btn" onclick="switchTaskSubTab('kk','config')">配置与说明</button>
                                <div style="flex:1"></div>
                                <input type="text" placeholder="搜索用户或关键词..." id="kkSearchManagementSearch" class="search-input">
                                <select id="kkSearchManagementStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="pending">待审核</option>
                                    <option value="approved">已通过</option>
                                    <option value="rejected">已拒绝</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 子页签：审核 -->
                            <div id="kkSub_review">
                                <div class="table-container">
                                    <table class="data-table" id="kkSearchManagementTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用户名</th>
                                                <th>申请关键词</th>
                                                <th>推广经验</th>
                                                <th>推广渠道</th>
                                                <th>申请时间</th>
                                                <th>审核状态</th>
                                                <th>分配关键词</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="9" class="loading">加载中...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：仓库 -->
                            <div id="kkSub_repo" style="display:none;">
                                <div class="search-filters" style="margin:0 0 8px 0;">
                                    <input type="text" placeholder="搜索关键词..." id="kkKeywordSearchInput" class="search-input" oninput="kkKeywordFiltersChanged()">
                                    <button class="btn" onclick="applyKKKeywordFilters()">筛选</button>
                                    <div style="flex:1"></div>
                                    <button class="btn btn-primary" onclick="openKKKeywordModal()"><i class="fas fa-plus"></i> 添加关键词</button>
                                    <button class="btn btn-secondary" style="margin-left:8px;" onclick="openKKBulkKeywordsModal()"><i class="fas fa-file-upload"></i> 批量导入</button>
                                    <button class="btn" style="margin-left:8px;" onclick="exportKKKeywordsCSV()"><i class="fas fa-download"></i> 导出CSV</button>
                                    <button class="btn btn-warning" style="margin-left:8px;" onclick="triggerKKKeywordTableCreate()"><i class="fas fa-wrench"></i> 创建表</button>
                                    <button class="btn btn-error" style="margin-left:8px;" onclick="triggerSecureKKKeywords()"><i class="fas fa-shield-alt"></i> 加固权限</button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table" id="kkKeywordTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>关键词</th>
                                                <th>出现次数</th>
                                                <th>添加时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="5" class="loading">暂无关键词</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：收益 -->
                            <div id="kkSub_earnings" style="display:none;">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>用户</th>
                                                <th>任务类型</th>
                                                <th>金额</th>
                                                <th>状态</th>
                                            </tr>
                                        </thead>
                                        <tbody id="kkEarningsInlineBody">
                                            <tr><td colspan="5" class="loading">从收益数据加载中...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：配置与说明 -->
                            <div id="kkSub_config" style="display:none;">
                                <div class="config-box">
                                    <p>这里可维护单价、校验规则与操作说明（占位）。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- x雷浏览器 任务中心（子页签） -->
                    <div class="card task-management-content" id="xraySearchManagement" style="display: none;">
                        <div class="card-header">
                            <h3>x雷浏览器 · 任务中心</h3>
                            <div class="search-filters" style="gap:8px;">
                                <button class="btn btn-primary" onclick="switchTaskSubTab('xray','review')">申请审核</button>
                                <button class="btn" onclick="switchTaskSubTab('xray','repo')">关键词仓库</button>
                                <button class="btn" onclick="switchTaskSubTab('xray','earnings')">收益记录</button>
                                <button class="btn" onclick="switchTaskSubTab('xray','config')">配置与说明</button>
                                <div style="flex:1"></div>
                                <input type="text" placeholder="搜索用户或关键词..." id="xraySearchManagementSearch" class="search-input">
                                <select id="xraySearchManagementStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="pending">待审核</option>
                                    <option value="approved">已通过</option>
                                    <option value="rejected">已拒绝</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 子页签：审核 -->
                            <div id="xraySub_review">
                                <div class="table-container">
                                    <table class="data-table" id="xraySearchManagementTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>用户名</th>
                                                <th>申请关键词</th>
                                                <th>推广经验</th>
                                                <th>推广渠道</th>
                                                <th>申请时间</th>
                                                <th>审核状态</th>
                                                <th>分配关键词</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="9" class="loading">加载中...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：仓库（可复用KK仓库结构，独立表/本地） -->
                            <div id="xraySub_repo" style="display:none;">
                                <div class="search-filters" style="margin:0 0 8px 0;">
                                    <input type="text" placeholder="搜索关键词..." id="xrayKeywordSearchInput" class="search-input" oninput="xrayKeywordFiltersChanged()">
                                    <button class="btn" onclick="applyXrayKeywordFilters()">筛选</button>
                                    <div style="flex:1"></div>
                                    <button class="btn btn-primary" onclick="openXrayKeywordModal()"><i class="fas fa-plus"></i> 添加关键词</button>
                                    <button class="btn btn-secondary" style="margin-left:8px;" onclick="triggerXrayExcelImport()"><i class="fas fa-file-upload"></i> 导入Excel/CSV</button>
                                    <button class="btn" style="margin-left:8px;" onclick="exportXrayKeywordsCSV()"><i class="fas fa-download"></i> 导出CSV</button>
                                    <button class="btn btn-warning" style="margin-left:8px;" onclick="triggerXrayKeywordTableCreate()"><i class="fas fa-wrench"></i> 创建表</button>
                                    <button class="btn btn-error" style="margin-left:8px;" onclick="triggerSecureXrayKeywords()"><i class="fas fa-shield-alt"></i> 加固权限</button>
                                </div>
                                <div class="table-container">
                                    <table class="data-table" id="xrayKeywordTable">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>关键词</th>
                                                <th>添加时间</th>
                                                <th>操作</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="4" class="loading">暂无关键词</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：收益 -->
                            <div id="xraySub_earnings" style="display:none;">
                                <div class="table-container">
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>时间</th>
                                                <th>用户</th>
                                                <th>任务类型</th>
                                                <th>金额</th>
                                                <th>状态</th>
                                            </tr>
                                        </thead>
                                        <tbody id="xrayEarningsInlineBody">
                                            <tr><td colspan="5" class="loading">从收益数据加载中...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- 子页签：配置与说明 -->
                            <div id="xraySub_config" style="display:none;">
                                <div class="config-box">
                                    <p>这里可维护x雷浏览器任务单价、规范、话术模板（占位）。</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- KK搜索关键词仓库（按钮切换显示） -->
                    <div class="card" id="kkSearchKeywordRepo" style="display: none;">
                        <div class="card-header">
                            <h3>KK搜索关键词仓库</h3>
                            <div class="search-filters" id="kkKeywordToolbar">
                                <button class="btn" data-kk-pane-target="review" onclick="toggleKKPane('review')">审核</button>
                                <button class="btn btn-primary" id="btnKKRepo2" data-kk-pane-target="repo" onclick="toggleKKPane('repo')">关键词仓库</button>
                                <input type="text" placeholder="搜索关键词..." id="kkKeywordSearchInput" class="search-input" oninput="kkKeywordFiltersChanged()">
                                <button class="btn" onclick="applyKKKeywordFilters()">筛选</button>
                                <div style="flex:1"></div>
                                <button class="btn btn-primary" onclick="openKKKeywordModal()"><i class="fas fa-plus"></i> 添加关键词</button>
                                <button class="btn btn-secondary" style="margin-left:8px;" onclick="openKKBulkKeywordsModal()"><i class="fas fa-file-upload"></i> 批量导入</button>
                                <button class="btn" style="margin-left:8px;" onclick="exportKKKeywordsCSV()"><i class="fas fa-download"></i> 导出CSV</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="kkKeywordTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>关键词</th>
                                            <th>添加时间</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="4" class="loading">加载中...</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 悟空搜索任务管理 -->
                    <div class="card task-management-content" id="wukongSearchManagement" style="display: none;">
                        <div class="card-header">
                            <h3>w空短剧搜索关键词申请审核</h3>
                            <div class="search-filters" style="gap:8px;">
                                <button class="btn btn-primary" onclick="switchTaskSubTab('wk','review')">申请审核</button>
                                <button class="btn" onclick="switchTaskSubTab('wk','repo')">关键词仓库</button>
                                <button class="btn" onclick="switchTaskSubTab('wk','earnings')">收益记录</button>
                                <button class="btn" onclick="switchTaskSubTab('wk','feedback')">用户回填记录</button>
                                <div style="flex:1"></div>
                                <input type="text" placeholder="搜索用户或关键词..." id="wukongSearchManagementSearch" class="search-input">
                                <select id="wukongSearchManagementStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="pending">待审核</option>
                                    <option value="approved">已通过</option>
                                    <option value="rejected">已拒绝</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="wukongSearchManagementTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>申请关键词</th>
                                            <th>推广经验</th>
                                            <th>推广渠道</th>
                                            <th>申请时间</th>
                                            <th>审核状态</th>
                                            <th>用户回填信息</th>
                                            <th>分配关键词</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="10" class="loading">暂无悟空搜索申请数据</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- 悟空搜索 · 用户回填记录子页 -->
                    <div class="card task-management-content" id="wkSub_feedback" style="display:none;">
                        <div class="card-header">
                            <h3>w空搜索 · 用户回填记录</h3>
                            <div class="search-filters" style="gap:8px;">
                                <button class="btn" onclick="switchTaskSubTab('wk','review')">申请审核</button>
                                <button class="btn" onclick="switchTaskSubTab('wk','repo')">关键词仓库</button>
                                <button class="btn" onclick="switchTaskSubTab('wk','earnings')">收益记录</button>
                                <button class="btn btn-primary" onclick="switchTaskSubTab('wk','feedback')">用户回填记录</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>申请ID</th>
                                            <th>用户名</th>
                                            <th>回填数量</th>
                                            <th>最新时间</th>
                                            <th>查看</th>
                                        </tr>
                                    </thead>
                                    <tbody id="wkFeedbackTableBody">
                                        <tr><td colspan="5" class="loading">加载中...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- KK网盘任务管理 -->
                    <div class="card task-management-content" id="kkDiskManagement" style="display: none;">
                        <div class="card-header">
                            <h3>KK网盘关键词申请审核</h3>
                            <div class="search-filters">
                                <input type="text" placeholder="搜索用户或关键词..." id="kkDiskManagementSearch" class="search-input">
                                <select id="kkDiskManagementStatusFilter" class="filter-select">
                                    <option value="">全部状态</option>
                                    <option value="pending">待审核</option>
                                    <option value="approved">已通过</option>
                                    <option value="rejected">已拒绝</option>
                                </select>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="kkDiskManagementTable">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>用户名</th>
                                            <th>申请关键词</th>
                                            <th>推广经验</th>
                                            <th>推广渠道</th>
                                            <th>申请时间</th>
                                            <th>审核状态</th>
                                            <th>分配关键词</th>
                                            <th>操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td colspan="9" class="loading">暂无KK网盘申请数据</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="analytics" class="page">
                    <div class="page-header">
                        <h2>数据分析</h2>
                        <div class="page-actions">
                            <div class="analytics-toolbar">
                                <button class="btn btn-secondary active" data-range="7" onclick="renderAnalytics(7)">近7天</button>
                                <button class="btn btn-secondary" data-range="14" onclick="renderAnalytics(14)">近14天</button>
                                <button class="btn btn-secondary" data-range="30" onclick="renderAnalytics(30)">近30天</button>
                                <select id="analyticsCompare" class="filter-select" style="margin-left:8px;">
                                    <option value="prev">对比: 上一周期</option>
                                    <option value="wow">对比: 上周同期</option>
                                    <option value="mom">对比: 上月同日</option>
                                    <option value="yoy">对比: 去年同日</option>
                                </select>
                                <div style="margin-left:8px; display:flex; gap:6px;">
                                    <button class="btn btn-secondary active" data-channel-by="amount" onclick="renderAnalytics()">按金额</button>
                                    <button class="btn btn-secondary" data-channel-by="count" onclick="renderAnalytics()">按记录数</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="analytics-grid">
                                <div class="analytics-card">
                                    <h3>关键指标</h3>
                                    <div class="kpi-row">
                                        <div class="kpi"><span class="kpi-label">新增用户</span><span><span id="kpiNewUsers">-</span><small id="kpiNewUsersDelta" class="kpi-delta"></small></span></div>
                                        <div class="kpi"><span class="kpi-label">今日收益</span><span><span id="kpiTodayIncome">-</span><small id="kpiTodayIncomeDelta" class="kpi-delta"></small></span></div>
                                        <div class="kpi"><span class="kpi-label">提现审核中</span><span id="kpiPendingWithdrawals">-</span></div>
                                    </div>
                                    <div class="kpi-row">
                                        <div class="kpi"><span class="kpi-label">任务申请</span><span id="kpiTaskApply">-</span></div>
                                        <div class="kpi"><span class="kpi-label">任务通过</span><span id="kpiTaskApproved">-</span></div>
                                        <div class="kpi"><span class="kpi-label">任务拒绝</span><span id="kpiTaskRejected">-</span></div>
                                    </div>
                                </div>
                                <div class="analytics-card">
                                    <h3>最近7天收益趋势</h3>
                                    <canvas id="incomeTrend"></canvas>
                                </div>
                                <div class="analytics-card">
                                    <h3>渠道占比</h3>
                                    <canvas id="channelPie"></canvas>
                                </div>
                                <div class="analytics-card">
                                    <h3>用户增长趋势</h3>
                                    <canvas id="userTrend"></canvas>
                                </div>
                                <div class="analytics-card">
                                    <h3>提现状态分布</h3>
                                    <canvas id="withdrawalPie"></canvas>
                                </div>
                                <div class="analytics-card">
                                    <h3>任务通过漏斗</h3>
                                    <canvas id="taskFunnel"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings" class="page">
                    <div class="page-header">
                        <h2>系统设置</h2>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="settings-form">
                                <!-- 已按需求移除：系统设置中的公告模块。请使用"公告管理"页面维护公告。 -->
                                <hr style="border:none;height:1px;background:#eee;margin:12px 0;">
                                <div class="form-group">
                                    <label>维护模式</label>
                                    <label class="switch">
                                        <input type="checkbox" id="settingMaintenanceEnabled">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="form-group">
                                    <label>提现方式</label>
                                    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
                                        <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="settingAlipayEnabled" checked> 支付宝</label>
                                        <label style="display:flex;align-items:center;gap:6px;"><input type="checkbox" id="settingWechatEnabled" checked> 微信</label>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>表格密度</label>
                                    <select id="settingTableDensity">
                                        <option value="normal">正常</option>
                                        <option value="dense">紧凑</option>
                                    </select>
                                </div>
                                <!-- 公告置顶条数、标签字典 设置已移除，改由公告管理维护 -->
                                <div class="form-group">
                                    <label>KK搜索 单价设置</label>
                                    <div class="form-row">
                                        <div class="form-group" style="min-width:160px;">
                                            <label>拉新</label>
                                            <input type="number" id="settingKKPullNew" step="0.1" placeholder="8.5">
                                        </div>
                                        <div class="form-group" style="min-width:160px;">
                                            <label>拉活</label>
                                            <input type="number" id="settingKKPullActive" step="0.1" placeholder="2.5">
                                        </div>
                                        <div class="form-group" style="min-width:160px;">
                                            <label>拉旧</label>
                                            <input type="number" id="settingKKPullOld" step="0.1" placeholder="0.3">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label>x雷浏览器 单价设置</label>
                                    <div class="form-row">
                                        <div class="form-group" style="min-width:160px;">
                                            <label>1-10 人</label>
                                            <input type="number" id="settingXR10" step="0.1" placeholder="7">
                                        </div>
                                        <div class="form-group" style="min-width:160px;">
                                            <label>10-100 人</label>
                                            <input type="number" id="settingXR100" step="0.1" placeholder="8">
                                        </div>
                                        <div class="form-group" style="min-width:160px;">
                                            <label>100-200 人</label>
                                            <input type="number" id="settingXR200" step="0.1" placeholder="9">
                                        </div>
                                        <div class="form-group" style="min-width:160px;">
                                            <label>200-1000 人</label>
                                            <input type="number" id="settingXR1000" step="0.1" placeholder="10">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
                                    <button class="btn btn-primary" onclick="saveSystemSettings()"><i class="fas fa-save"></i> 保存设置</button>
                                    <button class="btn" onclick="resetSystemSettings()" style="margin-left:8px;"><i class="fas fa-undo"></i> 恢复默认</button>
                                    <div style="margin-left:auto;display:flex;gap:8px;">
                                        <button class="btn btn-secondary" type="button" onclick="exportSystemSettings()"><i class="fas fa-download"></i> 导出设置</button>
                                        <label class="btn" style="cursor:pointer;">
                                            <i class="fas fa-upload"></i> 导入设置
                                            <input id="importSettingsFile" type="file" accept="application/json" style="display:none" onchange="importSystemSettings(event)">
                                        </label>
                                    </div>
                                </div>
                                <small style="color:#999;">设置保存在本地（localStorage），立即生效。</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 公告管理页面 -->
                <div id="announcements" class="page">
                    <div class="page-header">
                        <h2>公告管理</h2>
                        <div class="page-actions" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                            <button class="btn btn-primary" onclick="openAnnouncementModal()"><i class="fas fa-plus"></i> 新建公告</button>
                            <button class="btn" onclick="loadAnnouncementsData()"><i class="fas fa-sync"></i> 刷新</button>
                            <button class="btn btn-warning" onclick="openAnnouncementsSetupModal()"><i class="fas fa-wrench"></i> 初始化公告表</button>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="table-container">
                                <table class="data-table" id="annTable">
                                    <thead>
                                        <tr>
                                            <th style="width:60px;">ID</th>
                                            <th>标题</th>
                                            <th style="width:100px;">语言</th>
                                            <th style="width:70px;">置顶</th>
                                            <th style="width:180px;">创建时间</th>
                                            <th style="width:220px;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td colspan="6" class="loading">加载中...</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- KK网盘 · 申请详情 -->
    <div id="kdDetailModal" class="modal" style="display:none; align-items:center; justify-content:center;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>KK网盘 · 申请详情</h3>
                <button class="close-btn" onclick="(window.__closeModal?window.__closeModal:function(id){ var el=document.getElementById(id); if(el) el.style.display='none'; })('kdDetailModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="data-table">
                        <tbody>
                            <tr><th style="width:140px;">申请ID</th><td id="kdDetailId">-</td></tr>
                            <tr><th>用户名</th><td id="kdDetailUser">-</td></tr>
                            <tr><th>任务类型</th><td id="kdDetailTask">-</td></tr>
                            <tr><th>夸克uid</th><td id="kdDetailUid">-</td></tr>
                            <tr><th>夸克手机号</th><td id="kdDetailPhone">-</td></tr>
                            <tr><th>姓名</th><td id="kdDetailRealName">-</td></tr>
                            <tr><th>推广渠道</th><td id="kdDetailChannel">-</td></tr>
                            <tr><th>申请时间</th><td id="kdDetailTime">-</td></tr>
                            <tr><th>绑定截图</th><td id="kdDetailBind">-</td></tr>
                            <tr><th>状态</th><td id="kdDetailStatus">-</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" onclick="openApproveModal && openApproveModal(window.__kdDetailId)"><i class="fas fa-check"></i> 通过</button>
                <button class="btn btn-danger" onclick="openRejectModal && openRejectModal(window.__kdDetailId)"><i class="fas fa-times"></i> 拒绝</button>
            </div>
        </div>
    </div>

    <!-- 团长详情弹窗 -->
    <div id="leaderDetailModal" class="modal">
        <div class="modal-content" style="max-width:1000px;width:1000px;">
            <div class="modal-header" style="gap:10px;align-items:center;">
                <h3 id="leaderDetailTitle" style="flex:1">团长详情</h3>
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-secondary" type="button" title="复制团长ID" onclick="navigator.clipboard&&navigator.clipboard.writeText(window.__currLeaderId||'');showNotification('已复制ID','success')"><i class="fas fa-copy"></i> 复制ID</button>
                    <button class="btn" type="button" title="刷新" onclick="openLeaderDetail(window.__currLeaderId, window.__currLeaderLabel)"><i class="fas fa-sync"></i> 刷新</button>
                    <button class="close-btn" onclick="document.getElementById('leaderDetailModal').style.display='none'">&times;</button>
                </div>
            </div>
            <div class="modal-body leader-detail-body">
                <style>
                    .leader-detail-body .kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:10px}
                    .leader-detail-body .kcard{padding:14px 16px;border:1px solid #e5e7eb;border-radius:12px;background:linear-gradient(135deg,#f8fafc,#ffffff);box-shadow:0 6px 18px rgba(17,24,39,.04)}
                    .leader-detail-body .kval{font-size:22px;font-weight:800;color:#111827}
                    .leader-detail-body .kcap{font-size:12px;color:#6b7280;margin-top:6px}
                    #leaderInviteeTable th{position:sticky;top:0;background:#fff;z-index:1}
                    #leaderInviteeTable tbody tr{transition:background .15s ease}
                    #leaderInviteeTable tbody tr:hover{background:#f9fafb}
                </style>
                <div class="kpi">
                    <div class="kcard"><div class="kval" id="ldMembers">--</div><div class="kcap">一级成员</div></div>
                    <div class="kcard"><div class="kval" id="ldEarnings">--</div><div class="kcap">团队总收益</div></div>
                    <div class="kcard"><div class="kval" id="ldAvg">--</div><div class="kcap">人均收益</div></div>
                    <div class="kcard"><div class="kval" id="ldSince">--</div><div class="kcap">最早邀请时间</div></div>
                </div>
                <div class="table-container">
                    <table class="data-table" id="leaderInviteeTable">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>用户ID</th>
                                <th>用户名</th>
                                <th>加入时间</th>
                                <th>收益</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5" class="loading">加载中...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="exportLeaderInviteesCSV()"><i class="fas fa-download"></i> 导出CSV</button>
                <button class="btn btn-primary" onclick="document.getElementById('leaderDetailModal').style.display='none'">关闭</button>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户信息</h3>
                <button class="close-btn" onclick="closeModal('userModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <input type="hidden" id="userId">
                    <div class="form-group">
                        <label for="username">用户名</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label for="email">邮箱</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="password">密码</label>
                        <input type="password" id="password">
                    </div>
                    <div class="form-group">
                        <label for="points">积分</label>
                        <input type="number" id="points" value="0">
                    </div>
                    <div class="form-group">
                        <label for="status">状态</label>
                        <select id="status">
                            <option value="active">正常</option>
                            <option value="disabled">禁用</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('userModal')">取消</button>
                <button class="btn btn-primary" onclick="saveUser()">保存</button>
            </div>
        </div>
    </div>

    <!-- 用户编辑抽屉 -->
    <div id="userDrawer" class="modal" style="justify-content:flex-end;">
        <div class="modal-content" style="max-width:420px;width:420px;height:100vh;border-radius:0;">
            <div class="modal-header">
                <h3>编辑用户</h3>
                <button class="close-btn" onclick="closeModal('userDrawer')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userDrawerForm">
                    <input type="hidden" id="drawerUserId">
                    <div class="form-group">
                        <label>用户名</label>
                        <input type="text" id="drawerUsername">
                    </div>
                    <div class="form-group">
                        <label>邮箱</label>
                        <input type="email" id="drawerEmail">
                    </div>
                    <div class="form-group">
                        <label>积分</label>
                        <input type="number" id="drawerPoints" value="0">
                    </div>
                    <div class="form-group">
                        <label>状态</label>
                        <select id="drawerStatus">
                            <option value="active">正常</option>
                            <option value="disabled">禁用</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>新密码（可选）</label>
                        <input type="password" id="drawerPassword" placeholder="留空则不修改">
                    </div>
                    <div class="form-group">
                        <label>确认新密码</label>
                        <input type="password" id="drawerPassword2" placeholder="再次输入新密码">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-warning" onclick="resetUserPoints()">重置积分</button>
                <button class="btn btn-secondary" onclick="toggleUserStatus()">切换状态</button>
                <button class="btn" onclick="fillRandomPassword()">生成随机密码</button>
                <button class="btn btn-primary" onclick="saveUserFromDrawer()">保存</button>
            </div>
        </div>
    </div>

    <div id="earningsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>收益记录</h3>
                <button class="close-btn" onclick="closeModal('earningsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="earningsForm">
                    <input type="hidden" id="earningId">
                    <div class="form-group">
                        <label for="earningUser">用户</label>
                        <select id="earningUser" required>
                            <option value="">请选择用户</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="taskType">任务类型</label>
                        <select id="taskType" required>
                            <option value="">请选择任务类型</option>
                            <option value="夸克搜索任务">夸克搜索任务</option>
                            <option value="悟空搜索任务">悟空搜索任务</option>
                            <option value="签到奖励">签到奖励</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount">金额</label>
                        <input type="number" id="amount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="earningStatus">状态</label>
                        <select id="earningStatus">
                            <option value="已完成">已完成</option>
                            <option value="进行中">进行中</option>
                            <option value="已取消">已取消</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('earningsModal')">取消</button>
                <button class="btn btn-primary" onclick="saveEarning()">保存</button>
            </div>
        </div>
    </div>

    <!-- KK搜索收益添加模态框 -->
    <div id="kkSearchEarningsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>KK搜索收益记录</h3>
                <button class="close-btn" onclick="closeModal('kkSearchEarningsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="kkSearchEarningsForm">
                    <input type="hidden" id="kkEarningId">
                    <div class="form-group">
                        <label for="kkEarningKeyword">关键词</label>
                        <div class="keyword-search-container">
                            <div class="search-input-wrapper">
                                <input type="text" id="kkKeywordSearch" placeholder="🔍 搜索关键词或用户名，回车确认..." 
                                       onkeyup="handleKKKeywordSearch(event)" 
                                       onkeydown="handleKKKeywordNavigation(event)"
                                       onfocus="showKKSearchDropdown()" 
                                       autocomplete="off">
                                <i class="search-icon fas fa-search"></i>
                            </div>
                            <div class="search-dropdown" id="kkSearchDropdown" style="display: none;">
                                <div class="dropdown-header">
                                    <span class="result-count" id="kkResultCount">0 个结果</span>
                                    <button type="button" class="close-dropdown" onclick="hideKKSearchDropdown()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="dropdown-content" id="kkDropdownContent">
                                    <div class="dropdown-item placeholder">请输入关键词进行搜索</div>
                                </div>
                            </div>
                            <input type="hidden" id="kkEarningKeyword" required>
                            <div class="selected-keyword" id="kkSelectedKeyword" style="display: none;">
                                <span class="keyword-text"></span>
                                <button type="button" class="remove-keyword" onclick="clearKKSelectedKeyword()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>任务类型</label>
                        <input type="text" value="KK搜索" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pullNewCount">拉新数量</label>
                            <input type="number" id="pullNewCount" min="0" value="0" oninput="calculateKKEarningsAmount()" onchange="calculateKKEarningsAmount()">
                            <small>单价: ¥8.5</small>
                        </div>
                        <div class="form-group">
                            <label for="pullActiveCount">拉活数量</label>
                            <input type="number" id="pullActiveCount" min="0" value="0" oninput="calculateKKEarningsAmount()" onchange="calculateKKEarningsAmount()">
                            <small>单价: ¥2.5</small>
                        </div>
                        <div class="form-group">
                            <label for="pullOldCount">拉旧数量</label>
                            <input type="number" id="pullOldCount" min="0" value="0" oninput="calculateKKEarningsAmount()" onchange="calculateKKEarningsAmount()">
                            <small>单价: ¥0.3</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>总金额</label>
                        <input type="text" id="kkTotalAmount" readonly style="background-color: #f5f5f5; font-weight: bold; color: #007bff;" value="¥0.00">
                    </div>
                    <div class="form-group">
                        <label for="kkEarningStatus">状态</label>
                        <select id="kkEarningStatus">
                            <option value="已完成">已完成</option>
                            <option value="进行中">进行中</option>
                            <option value="已取消">已取消</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('kkSearchEarningsModal')">取消</button>
                <button class="btn btn-primary" onclick="saveKKSearchEarning()">保存</button>
            </div>
        </div>
    </div>

    <!-- x雷浏览器收益添加模态框 -->
    <div id="xraySearchEarningsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>x雷浏览器收益记录</h3>
                <button class="close-btn" onclick="closeModal('xraySearchEarningsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="xraySearchEarningsForm">
                    <input type="hidden" id="xrayEarningId">
                    <div class="form-group">
                        <label for="xrayEarningKeyword">关键词</label>
                        <div class="keyword-search-container">
                            <div class="search-input-wrapper">
                                <input type="text" id="xrayKeywordSearch" placeholder="🔍 搜索关键词或用户名，回车确认..." 
                                       onkeyup="handleXrayKeywordSearch(event)" 
                                       onkeydown="handleXrayKeywordNavigation(event)"
                                       onfocus="showXraySearchDropdown()" 
                                       autocomplete="off">
                                <i class="search-icon fas fa-search"></i>
                            </div>
                            <div class="search-dropdown" id="xraySearchDropdown" style="display: none;">
                                <div class="dropdown-header">
                                    <span class="result-count" id="xrayResultCount">0 个结果</span>
                                    <button type="button" class="close-dropdown" onclick="hideXraySearchDropdown()">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="dropdown-content" id="xrayDropdownContent">
                                    <div class="dropdown-item placeholder">请输入关键词进行搜索</div>
                                </div>
                            </div>
                            <input type="hidden" id="xrayEarningKeyword" required>
                            <div class="selected-keyword" id="xraySelectedKeyword" style="display: none;">
                                <span class="keyword-text"></span>
                                <button type="button" class="remove-keyword" onclick="clearXraySelectedKeyword()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>任务类型</label>
                        <input type="text" value="x雷浏览器搜索" readonly style="background-color: #f5f5f5;">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="xrPullNew10">拉新1-10人</label>
                            <input type="number" id="xrPullNew10" min="0" value="0" onchange="calculateXrayEarningsAmount()">
                            <small>单价: ¥7/人</small>
                        </div>
                        <div class="form-group">
                            <label for="xrPullNew100">拉新10-100人</label>
                            <input type="number" id="xrPullNew100" min="0" value="0" onchange="calculateXrayEarningsAmount()">
                            <small>单价: ¥8/人</small>
                        </div>
                        <div class="form-group">
                            <label for="xrPullNew200">拉新100-200人</label>
                            <input type="number" id="xrPullNew200" min="0" value="0" onchange="calculateXrayEarningsAmount()">
                            <small>单价: ¥9/人</small>
                        </div>
                        <div class="form-group">
                            <label for="xrPullNew1000">拉新200-1000人</label>
                            <input type="number" id="xrPullNew1000" min="0" value="0" onchange="calculateXrayEarningsAmount()">
                            <small>单价: ¥10/人</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>总金额</label>
                        <input type="text" id="xrayTotalAmount" readonly style="background-color: #f5f5f5; font-weight: bold; color: #007bff;" value="¥0.00">
                    </div>
                    <div class="form-group">
                        <label for="xrayEarningStatus">状态</label>
                        <select id="xrayEarningStatus">
                            <option value="已完成">已完成</option>
                            <option value="进行中">进行中</option>
                            <option value="已取消">已取消</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('xraySearchEarningsModal')">取消</button>
                <button class="btn btn-primary" onclick="saveXraySearchEarning()">保存</button>
            </div>
        </div>
    </div>

    <!-- 其他收益添加模态框 -->
    <div id="otherEarningModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加其他收益</h3>
                <button class="close-btn" onclick="closeModal('otherEarningModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="otherEarningForm">
                    <input type="hidden" id="otherEarningId">
                    <div class="form-group">
                        <label for="otherEarningUser">用户</label>
                        <select id="otherEarningUser" required>
                            <option value="">请选择用户</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="otherEarningType">收益类型</label>
                        <select id="otherEarningType" required>
                            <option value="">请选择类型</option>
                            <option value="活动收益">活动收益</option>
                            <option value="团长收益">团长收益</option>
                            <option value="其他收益">其他收益</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="otherEarningAmount">金额</label>
                        <input type="number" id="otherEarningAmount" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="otherEarningStatus">状态</label>
                        <select id="otherEarningStatus">
                            <option value="已完成">已完成</option>
                            <option value="进行中">进行中</option>
                            <option value="已取消">已取消</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="otherEarningNote">备注</label>
                        <input type="text" id="otherEarningNote" placeholder="可选，说明来源或备注">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('otherEarningModal')">取消</button>
                <button class="btn btn-primary" onclick="saveOtherEarning()">保存</button>
            </div>
        </div>
    </div>

    <!-- 提现详情模态框 -->
    <div id="withdrawalModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>提现详情</h3>
                <button class="close-btn" onclick="closeModal('withdrawalModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="withdrawalDetails">
                    <!-- 提现详情内容将通过JavaScript动态填充 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('withdrawalModal')">关闭</button>
            </div>
        </div>
    </div>

    <!-- 审核通过模态框 -->
    <div id="approveModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>审核通过</h3>
                <button class="close-btn" onclick="closeModal('approveModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="approveForm">
                    <input type="hidden" id="approveApplicationId">
                    <div class="application-info">
                        <div class="info-item">
                            <label>申请用户:</label>
                            <span id="approveUserName">-</span>
                        </div>
                        <!-- KK网盘专属字段 -->
                        <div class="info-item kk-drive-field"><label>任务类型:</label><span id="approveTaskType">-</span></div>
                        <div class="info-item kk-drive-field"><label>夸克uid:</label><span id="approveQuarkUid">-</span></div>
                        <div class="info-item kk-drive-field"><label>夸克手机号:</label><span id="approveQuarkPhone">-</span></div>
                        <div class="info-item kk-drive-field"><label>姓名:</label><span id="approveRealName">-</span></div>
                        <div class="info-item kk-drive-field"><label>推广渠道:</label><span id="approveChannel">-</span></div>
                        <div class="info-item kk-drive-field"><label>绑定截图:</label><span id="approveBindImg">-</span></div>
                        
                        <!-- 搜索任务专属：申请的关键词 -->
                        <div class="info-item search-task-field" style="display:none;">
                            <label>申请关键词:</label>
                            <span id="approveRequestedKeywords">-</span>
                        </div>
                    </div>
                    
                    <!-- 搜索任务专属：分配关键词输入框 -->
                    <div class="form-group search-task-field" style="display:none;">
                        <label for="approveAssignKeywords">分配关键词 <span style="color:red;">*</span>:</label>
                        <input type="text" id="approveAssignKeywords" placeholder="请输入要分配给用户的关键词，多个用逗号分隔">
                        <small style="color:#6b7280;">例如：关键词1,关键词2,关键词3</small>
                    </div>
                    
                    <!-- 备注说明 -->
                    <div class="form-group">
                        <label for="approveNote">备注说明 (可选):</label>
                        <textarea id="approveNote" rows="2" placeholder="审核通过的备注说明..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('approveModal')">取消</button>
                <button class="btn btn-success" id="approveConfirmBtn" onclick="confirmApproval()">
                    <i class="fas fa-check"></i> 确认通过
                </button>
            </div>
        </div>
    </div>

    <!-- 任务数据日期修改器 -->
    <div id="taskDateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>任务数据日期修改器</h3>
                <button class="close-btn" onclick="closeModal('taskDateModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="taskDateForm">
                    <div class="form-group">
                        <label>KK搜索 最新数据日期</label>
                        <input type="date" id="date_kk" />
                    </div>
                    <div class="form-group">
                        <label>x雷浏览器搜索 最新数据日期</label>
                        <input type="date" id="date_xray" />
                    </div>
                    <div class="form-group">
                        <label>悟空搜索 最新数据日期</label>
                        <input type="date" id="date_wukong" />
                    </div>
                    <div class="form-group">
                        <label>KK网盘 最新数据日期</label>
                        <input type="date" id="date_kkdisk" />
                    </div>
                    <small>保存后首页「任务卡片」的"最新数据日期"将实时更新</small>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('taskDateModal')">取消</button>
                <button class="btn btn-primary" onclick="saveTaskDates()">保存</button>
            </div>
        </div>
    </div>

    <style>
        .floating-config-btn{ position:fixed; right:24px; bottom:24px; z-index:999; }
    </style>
    <button class="btn btn-primary floating-config-btn" onclick="openTaskDateModal()">数据日期</button>

    <!-- 审核拒绝模态框 -->
    <div id="rejectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>审核拒绝</h3>
                <button class="close-btn" onclick="closeModal('rejectModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="rejectForm">
                    <input type="hidden" id="rejectApplicationId">
                    <div class="application-info">
                        <div class="info-item">
                            <label>申请用户:</label>
                            <span id="rejectUserName">-</span>
                        </div>
                        <div class="info-item">
                            <label>申请关键词:</label>
                            <span id="rejectRequestKeywords">-</span>
                        </div>
                        <div class="info-item">
                            <label>推广渠道:</label>
                            <span id="rejectChannel">-</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="rejectReason">拒绝原因:</label>
                        <select id="rejectReason" required>
                            <option value="">请选择拒绝原因</option>
                            <option value="关键词不符合要求">关键词不符合要求</option>
                            <option value="推广经验不足">推广经验不足</option>
                            <option value="推广渠道不合适">推广渠道不合适</option>
                            <option value="重复申请">重复申请</option>
                            <option value="其他原因">其他原因</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="rejectNote">详细说明:</label>
                        <textarea id="rejectNote" rows="3" placeholder="请详细说明拒绝的原因，用户将看到此信息..." required></textarea>
                        <small class="form-hint">用户将在"查看关键词"页面看到拒绝信息</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('rejectModal')">取消</button>
                <button class="btn btn-danger" onclick="confirmRejection()">
                    <i class="fas fa-times"></i> 确认拒绝
                </button>
            </div>
        </div>
    </div>

    <!-- 标记关键词失效模态框 -->
    <div id="invalidateKeywordModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>标记关键词失效</h3>
                <button class="close-btn" onclick="closeModal('invalidateKeywordModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="invalidateForm">
                    <input type="hidden" id="invalidUserId">
                    <input type="hidden" id="invalidTaskType">
                    <div class="form-group">
                        <label>要失效的关键词（可多条，逗号/空格/换行分隔）</label>
                        <textarea id="invalidKeywordsInput" rows="4" placeholder="示例：苹果手机\n安卓刷机"></textarea>
                    </div>
                    <div class="form-group">
                        <label>原因（可选）</label>
                        <input id="invalidReason" type="text" placeholder="如：违规词、重复、不可投放...">
                    </div>
                    <small class="form-hint">标记后：用户无法再使用这些关键词，且与这些关键词相关的收益不予结算。</small>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('invalidateKeywordModal')">取消</button>
                <button class="btn btn-warning" onclick="confirmInvalidateKeywords()"><i class="fas fa-ban"></i> 确认失效</button>
            </div>
        </div>
    </div>

    <!-- 取消关键词失效模态框 -->
    <div id="cancelInvalidModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>取消关键词失效</h3>
                <button class="close-btn" onclick="closeModal('cancelInvalidModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="cancelInvalidForm">
                    <input type="hidden" id="cancelInvalidUserId">
                    <input type="hidden" id="cancelInvalidTaskType">
                    <div class="form-group">
                        <label>要恢复的关键词（可多条，逗号/空格/换行分隔）</label>
                        <textarea id="cancelInvalidKeywordsInput" rows="3" placeholder="示例：zwb\nkyd"></textarea>
                    </div>
                    <small class="form-hint">恢复后：用户可重新使用并可结算相关收益。</small>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('cancelInvalidModal')">取消</button>
                <button class="btn btn-primary" onclick="confirmCancelInvalidKeywords()"><i class="fas fa-check"></i> 确认恢复</button>
            </div>
        </div>
    </div>

    <!-- 公告编辑模态框 -->
    <div id="announcementModal" class="modal">
        <div class="modal-content" style="max-width:820px;width:820px;">
            <div class="modal-header">
                <h3 id="annModalTitle">新建公告</h3>
                <button class="close-btn" onclick="closeModal('announcementModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="announcementForm">
                    <input type="hidden" id="annId">
                    <div class="form-row">
                        <div class="form-group" style="min-width:260px;flex:1;">
                            <label>标题</label>
                            <input type="text" id="annTitle" placeholder="请输入标题" required>
                        </div>
                        <div class="form-group" style="min-width:160px;">
                            <label>语言</label>
                            <select id="annLang">
                                <option value="zh-CN">简体中文 (zh-CN)</option>
                                <option value="zh-TW">繁體中文 (zh-TW)</option>
                                <option value="en">English (en)</option>
                            </select>
                        </div>
                        <div class="form-group" style="min-width:120px;display:flex;align-items:flex-end;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="annPinned"> 置顶
                            </label>
                        </div>
                        <div class="form-group" style="min-width:160px;display:flex;align-items:flex-end;">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="annPopup"> 弹窗展示
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>内容</label>
                        <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center;flex-wrap:wrap;">
                            <button class="btn btn-secondary" type="button" onclick="document.getElementById('annImageFile').click()"><i class="fas fa-image"></i> 上传图片</button>
                            <small style="color:#64748b;">支持粘贴或上传图片，自动插入到内容（HTML）</small>
                            <input type="file" id="annImageFile" accept="image/*" style="display:none" onchange="handleAnnImageSelected(event)">
                        </div>
                        <textarea id="annContent" rows="10" placeholder="支持直接输入HTML（推荐），或粘贴富文本/图片"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group" style="min-width:240px;flex:1;">
                            <label>标签（逗号分隔）</label>
                            <input type="text" id="annTags" placeholder="如：结算,假期,更新">
                        </div>
                        <div class="form-group" style="min-width:220px;">
                            <label>发布时间</label>
                            <input type="datetime-local" id="annPublishAt">
                        </div>
                        <div class="form-group" style="min-width:220px;">
                            <label>过期时间(可选)</label>
                            <input type="datetime-local" id="annExpireAt">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('announcementModal')">取消</button>
                <button class="btn btn-primary" onclick="saveAnnouncement()">保存</button>
            </div>
        </div>
    </div>

    <!-- 公告初始化指引 -->
    <div id="announcementSetupModal" class="modal">
        <div class="modal-content" style="max-width:860px;width:860px;">
            <div class="modal-header">
                <h3>初始化公告表与存储（在 Supabase SQL 编辑器中执行）</h3>
                <button class="close-btn" onclick="closeModal('announcementSetupModal')">&times;</button>
            </div>
            <div class="modal-body">
<pre id="annSetupSQL" style="background:#0b1021;color:#e5e7eb;padding:12px;border-radius:8px;overflow:auto;white-space:pre;line-height:1.4;">
-- 1) 创建公告表（允许匿名直接访问：RLS 关闭）
CREATE TABLE IF NOT EXISTS public.announcements (
    id uuid primary key default gen_random_uuid(),
    title text,
    content text,
    publish_at timestamptz null,
    expire_at timestamptz null,
    created_at timestamptz default now()
);
ALTER TABLE public.announcements DISABLE ROW LEVEL SECURITY;
CREATE INDEX IF NOT EXISTS idx_ann_created_at ON public.announcements(created_at DESC);

-- 2) 创建公共存储桶（可选：用于公告内插图）
INSERT INTO storage.buckets (id, name, public)
SELECT 'announcements','announcements', true
WHERE NOT EXISTS (SELECT 1 FROM storage.buckets WHERE id='announcements');

-- 3) 允许匿名从该存储桶读/写（如需更严谨，可按需收紧）
ALTER TABLE storage.objects ENABLE ROW LEVEL SECURITY;
DROP POLICY IF EXISTS ann_read ON storage.objects;
CREATE POLICY ann_read ON storage.objects FOR SELECT TO anon USING (bucket_id = 'announcements');
DROP POLICY IF EXISTS ann_insert ON storage.objects;
CREATE POLICY ann_insert ON storage.objects FOR INSERT TO anon WITH CHECK (bucket_id = 'announcements');
DROP POLICY IF EXISTS ann_update ON storage.objects;
CREATE POLICY ann_update ON storage.objects FOR UPDATE TO anon USING (bucket_id = 'announcements');
DROP POLICY IF EXISTS ann_delete ON storage.objects;
CREATE POLICY ann_delete ON storage.objects FOR DELETE TO anon USING (bucket_id = 'announcements');
</pre>
                <div style="display:flex;gap:8px;align-items:center;margin-top:8px;">
                    <button class="btn" onclick="copyAnnSetupSQL()"><i class="fas fa-copy"></i> 复制SQL</button>
                    <small style="color:#64748b;">在 Supabase 项目 → SQL Editor 中执行以上脚本。执行完成后返回本页点击"刷新"。</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeModal('announcementSetupModal')">我已执行，关闭</button>
            </div>
        </div>
    </div>

    <!-- 🔧 修复：超级健壮的Supabase加载机制 -->
    <script>
        // 🚀 创建一个备用Supabase客户端，确保页面至少能正常显示
        function createFallbackSupabaseClient() {
            console.log('🔧 使用备用Supabase客户端（数据将显示为空，但页面功能正常）');
            
            const mockClient = {
                from: (table) => ({
                    select: (columns, options) => {
                        // 返回空数据但格式正确的Promise
                        const result = { 
                            data: [], 
                            error: null, 
                            count: 0 
                        };
                        
                        return {
                            eq: () => ({
                                order: () => ({ limit: () => Promise.resolve(result) }),
                                limit: () => Promise.resolve(result)
                            }),
                            order: () => ({ limit: () => Promise.resolve(result) }),
                            limit: () => Promise.resolve(result),
                            single: () => Promise.resolve({ data: null, error: null }),
                            then: (callback) => callback(result)
                        };
                    },
                    insert: () => ({
                        select: () => ({ single: () => Promise.resolve({ data: null, error: null }) })
                    }),
                    update: () => ({ eq: () => Promise.resolve({ data: null, error: null }) }),
                    delete: () => ({ eq: () => Promise.resolve({ data: null, error: null }) })
                })
            };
            
            return mockClient;
        }
        
        function loadSupabase() {
            return new Promise((resolve) => {
                console.log('🔄 开始加载Supabase库...');
                
                // 🔧 更可靠的CDN列表
                const cdnUrls = [
                    'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.js',
                    'https://unpkg.com/@supabase/supabase-js@2.39.7/dist/umd/supabase.js', 
                    'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2',
                    'https://unpkg.com/@supabase/supabase-js@2',
                    'https://esm.sh/@supabase/supabase-js@2',
                    'https://cdn.skypack.dev/@supabase/supabase-js@2'
                ];
                
                let currentIndex = 0;
                
                function tryNextCdn() {
                    if (currentIndex >= cdnUrls.length) {
                        console.warn('⚠️ 所有CDN都失败，使用备用客户端');
                        window.supabase = {
                            createClient: () => createFallbackSupabaseClient()
                        };
                        resolve(); // 🔧 确保总是resolve，不会reject
                        return;
                    }
                    
                    const script = document.createElement('script');
                    const currentUrl = cdnUrls[currentIndex];
                    
                    console.log(`📡 尝试CDN ${currentIndex + 1}/${cdnUrls.length}: ${currentUrl}`);
                    
                    script.src = currentUrl;
                    script.async = false; // 🔧 同步加载更可靠
                    
                    const timeout = setTimeout(() => {
                        console.warn(`⏰ CDN ${currentIndex + 1} 超时，尝试下一个`);
                        try { document.head.removeChild(script); } catch (e) {}
                        currentIndex++;
                        tryNextCdn();
                    }, 3000); // 3秒超时
                    
                    script.onload = () => {
                        clearTimeout(timeout);
                        console.log(`✅ CDN ${currentIndex + 1} 加载成功！`);
                        resolve();
                    };
                    
                    script.onerror = () => {
                        clearTimeout(timeout);
                        console.warn(`❌ CDN ${currentIndex + 1} 加载失败，尝试下一个`);
                        try { document.head.removeChild(script); } catch (e) {}
                        currentIndex++;
                        tryNextCdn();
                    };
                    
                    document.head.appendChild(script);
                }
                
                tryNextCdn();
            });
        }
        
        // 页面加载完成后开始加载
        document.addEventListener('DOMContentLoaded', () => {
            loadSupabase().then(() => {
                console.log('✅ Supabase初始化完成，加载主脚本...');
                
                // 🔧 确保主脚本能正常加载
                const mainScript = document.createElement('script');
                mainScript.src = 'admin-script.js';
                
                mainScript.onload = () => {
                    console.log('🎉 管理面板已完全加载！');
                    try{ if(typeof loadLeadersForAdmin==='function') loadLeadersForAdmin(); }catch(_){ }
                };
                
                mainScript.onerror = () => {
                    console.error('❌ 主脚本加载失败');
                    // 显示简单的错误提示但不影响页面
                    const errorNotification = document.createElement('div');
                    errorNotification.innerHTML = `
                        <div style="position: fixed; top: 20px; right: 20px; background: #f44336; color: white; padding: 12px 16px; border-radius: 6px; z-index: 10000; box-shadow: 0 4px 8px rgba(0,0,0,0.2);">
                            ⚠️ 脚本加载失败，功能可能受限
                            <button onclick="location.reload()" style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 4px 8px; border-radius: 4px; margin-left: 8px; cursor: pointer;">
                                🔄 刷新
                            </button>
                        </div>
                    `;
                    document.body.appendChild(errorNotification);
                    
                    // 5秒后自动隐藏
                    setTimeout(() => {
                        errorNotification.remove();
                    }, 5000);
                };
                
                document.head.appendChild(mainScript);
            });
        });
    </script>
    <script>
        document.addEventListener('click', function(e){
            var t = e.target;
            if(!t) return;
            if(t.matches('[data-open="xraySearchEarnings"]')){
                try{ if(typeof loadKKSearchKeywordsForSelect==='function'){ loadKKSearchKeywordsForSelect(); } }catch(_){ }
            }
        });
    </script>

    <!-- 用户回填信息 · 悟空搜索 -->
    <div id="wkFeedbackModal" class="modal" style="display:none; align-items:center; justify-content:center;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>用户回填信息</h3>
                <button class="close-btn" onclick="__closeModal('wkFeedbackModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>回填内容</th>
                            </tr>
                        </thead>
                        <tbody id="wkFeedbackList">
                            <tr><td colspan="2" class="loading">暂无回填记录</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="__closeModal('wkFeedbackModal')">关闭</button>
            </div>
        </div>
    </div>

</body>
</html>












