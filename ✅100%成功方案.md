# âœ… 100%æˆåŠŸæ–¹æ¡ˆ - åˆ†æ­¥æ‰§è¡Œ

## ğŸ¯ é—®é¢˜åŸå› 

`auth.uid()` åœ¨SQLç¼–è¾‘å™¨ä¸­å¯èƒ½è¿”å›nullï¼Œå¯¼è‡´æ’å…¥å¤±è´¥ã€‚

**è§£å†³æ–¹æ³•**ï¼šåˆ†ä¸¤æ­¥æ‰§è¡Œï¼Œæ‰‹åŠ¨æ›¿æ¢UUIDã€‚

---

## ç¬¬1æ­¥ï¼šåªåˆ›å»ºè¡¨ï¼ˆ100%æˆåŠŸï¼‰

**å¤åˆ¶ä¸‹é¢çš„SQLï¼Œç²˜è´´åˆ°Supabaseæ‰§è¡Œ**ï¼š

```sql
-- åªåˆ›å»ºè¡¨ï¼Œä¸æ’å…¥æ•°æ®
CREATE TABLE IF NOT EXISTS leaders (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID NOT NULL UNIQUE,
  level VARCHAR(20) DEFAULT 'bronze',
  invite_code VARCHAR(10) UNIQUE NOT NULL,
  total_members INT DEFAULT 0,
  level1_members INT DEFAULT 0,
  level2_members INT DEFAULT 0,
  level3_members INT DEFAULT 0,
  total_commission DECIMAL(10,2) DEFAULT 0,
  pending_commission DECIMAL(10,2) DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS team_members (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  leader_id UUID NOT NULL,
  member_id UUID NOT NULL,
  level INT NOT NULL,
  contribution DECIMAL(10,2) DEFAULT 0,
  status VARCHAR(20) DEFAULT 'active',
  joined_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS leader_commissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  leader_id UUID NOT NULL,
  type VARCHAR(20) NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  source_user_id UUID NOT NULL,
  source_description TEXT,
  status VARCHAR(20) DEFAULT 'pending',
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS leader_levels (
  level VARCHAR(20) PRIMARY KEY,
  name VARCHAR(50),
  required_members INT,
  commission_rate_1 DECIMAL(5,2)
);

INSERT INTO leader_levels VALUES
('bronze', 'é’é“œå›¢é•¿', 0, 5.00),
('silver', 'ç™½é“¶å›¢é•¿', 10, 8.00),
('gold', 'é»„é‡‘å›¢é•¿', 50, 10.00),
('platinum', 'é“‚é‡‘å›¢é•¿', 100, 12.00),
('diamond', 'é’»çŸ³å›¢é•¿', 200, 15.00)
ON CONFLICT DO NOTHING;

SELECT 'âœ… è¡¨åˆ›å»ºæˆåŠŸï¼' as ç»“æœ;
```

**çœ‹åˆ° "âœ… è¡¨åˆ›å»ºæˆåŠŸï¼" å°±OKï¼**

---

## ç¬¬2æ­¥ï¼šæŸ¥è¯¢ä½ çš„ç”¨æˆ·ID

**æ–°å»ºä¸€ä¸ªæŸ¥è¯¢ï¼Œæ‰§è¡Œ**ï¼š

```sql
SELECT id, email FROM auth.users;
```

**ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æœ**ï¼š
```
id: be9d66f3-46bd-4702-a9e5-fc715cca5bfa
email: zwq200394@qq.com
```

**å¤åˆ¶é‚£ä¸ªID**ï¼ˆé¼ æ ‡é€‰ä¸­æ•´ä¸ªUUID â†’ å³é”®å¤åˆ¶ï¼‰

ä¾‹å¦‚ï¼š`be9d66f3-46bd-4702-a9e5-fc715cca5bfa`

---

## ç¬¬3æ­¥ï¼šæ·»åŠ å›¢é•¿æ•°æ®ï¼ˆç²˜è´´ä½ çš„IDï¼‰

**å¤åˆ¶ä¸‹é¢çš„SQL**ï¼Œ**æŠŠç¬¬2è¡Œçš„UUIDæ›¿æ¢æˆä½ åˆšæ‰å¤åˆ¶çš„ID**ï¼Œç„¶åæ‰§è¡Œï¼š

```sql
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
VALUES (
  'be9d66f3-46bd-4702-a9e5-fc715cca5bfa',  -- âš ï¸ ç²˜è´´ä½ çš„UUIDï¼
  'gold',
  'R8da6a3N',
  2,
  2
);

SELECT 'âœ… å›¢é•¿æ·»åŠ æˆåŠŸï¼' as ç»“æœ;
SELECT * FROM leaders;
```

**åº”è¯¥çœ‹åˆ°ä½ çš„å›¢é•¿æ•°æ®ï¼**

---

## ç¬¬4æ­¥ï¼šæ·»åŠ æµ‹è¯•ä½£é‡‘

**å…ˆæŸ¥è¯¢ä½ çš„å›¢é•¿ID**ï¼š

```sql
SELECT id, user_id, invite_code FROM leaders;
```

**å¤åˆ¶ leader_id**ï¼ˆç¬¬ä¸€åˆ—çš„UUIDï¼‰

**ç„¶åæ‰§è¡Œ**ï¼ˆæ›¿æ¢leader_idå’Œuser_idï¼‰ï¼š

```sql
INSERT INTO leader_commissions (leader_id, type, amount, source_user_id, source_description)
VALUES (
  'è¿™é‡Œç²˜è´´leader_id',  -- âš ï¸ ç²˜è´´ä½ çš„leader_id
  'level1',
  50.00,
  'è¿™é‡Œç²˜è´´user_id',    -- âš ï¸ ç²˜è´´ä½ çš„user_id
  'æµ‹è¯•ä½£é‡‘'
);

SELECT 'âœ… ä½£é‡‘æ·»åŠ æˆåŠŸï¼' as ç»“æœ;
```

---

## âœ… éªŒè¯æ‰€æœ‰æ•°æ®

```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨çš„æ•°æ®é‡
SELECT 
  'leaders' as è¡¨å, COUNT(*) as è®°å½•æ•° FROM leaders
UNION ALL
SELECT 'team_members', COUNT(*) FROM team_members
UNION ALL
SELECT 'leader_commissions', COUNT(*) FROM leader_commissions
UNION ALL
SELECT 'leader_levels', COUNT(*) FROM leader_levels;
```

**åº”è¯¥çœ‹åˆ°**ï¼š
```
leaders           | 1
team_members      | 0
leader_commissions| 1
leader_levels     | 5
```

---

## ğŸ¯ å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] ç¬¬1æ­¥ï¼šåˆ›å»ºè¡¨ - çœ‹åˆ°"è¡¨åˆ›å»ºæˆåŠŸ"
- [ ] ç¬¬2æ­¥ï¼šæŸ¥è¯¢user_id - å¤åˆ¶åˆ°äº†UUID
- [ ] ç¬¬3æ­¥ï¼šæ·»åŠ å›¢é•¿ - çœ‹åˆ°"å›¢é•¿æ·»åŠ æˆåŠŸ"
- [ ] ç¬¬4æ­¥ï¼šæ·»åŠ ä½£é‡‘ - çœ‹åˆ°"ä½£é‡‘æ·»åŠ æˆåŠŸ"
- [ ] éªŒè¯ï¼šæŸ¥è¯¢æ˜¾ç¤ºæ­£ç¡®çš„è®°å½•æ•°

---

## ğŸ“ ç¤ºä¾‹ï¼ˆè·Ÿç€åšï¼‰

### å‡è®¾ä½ æŸ¥åˆ°çš„IDæ˜¯ï¼š`be9d66f3-46bd-4702-a9e5-fc715cca5bfa`

**æ·»åŠ å›¢é•¿**ï¼š
```sql
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
VALUES (
  'be9d66f3-46bd-4702-a9e5-fc715cca5bfa',  -- ä½ çš„çœŸå®ID
  'gold',
  'R8da6a3N',
  2,
  2
);
```

**æ·»åŠ ä½£é‡‘**ï¼š
```sql
-- å…ˆæŸ¥leadersè¡¨å¾—åˆ°leader_id
SELECT id FROM leaders WHERE user_id = 'be9d66f3-46bd-4702-a9e5-fc715cca5bfa';
-- å‡è®¾å¾—åˆ° leader_id: xxx-yyy-zzz

INSERT INTO leader_commissions (leader_id, type, amount, source_user_id, source_description)
VALUES (
  'xxx-yyy-zzz',  -- leader_id
  'level1',
  50.00,
  'be9d66f3-46bd-4702-a9e5-fc715cca5bfa',  -- user_id
  'æµ‹è¯•ä½£é‡‘'
);
```

---

## ğŸš¨ é‡è¦æé†’

### UUIDæ ¼å¼è¦æ±‚
âœ… æ­£ç¡®ï¼š`'be9d66f3-46bd-4702-a9e5-fc715cca5bfa'`ï¼ˆæœ‰å•å¼•å·ï¼‰  
âŒ é”™è¯¯ï¼š`be9d66f3-46bd-4702-a9e5-fc715cca5bfa`ï¼ˆæ²¡æœ‰å¼•å·ï¼‰  
âŒ é”™è¯¯ï¼š`"be9d66f3-46bd-4702-a9e5-fc715cca5bfa"`ï¼ˆåŒå¼•å·ï¼‰  
âŒ é”™è¯¯ï¼š`'ä½ çš„user_id'`ï¼ˆæ²¡æœ‰æ›¿æ¢ï¼‰

---

## ğŸ‰ æˆåŠŸå

æ‰€æœ‰æ­¥éª¤å®Œæˆåï¼Œåœ¨SQLç¼–è¾‘å™¨æ‰§è¡Œï¼š

```sql
SELECT * FROM leaders WHERE invite_code = 'R8da6a3N';
```

åº”è¯¥èƒ½çœ‹åˆ°ä½ çš„å›¢é•¿æ•°æ®ï¼

---

**ç«‹å³å¼€å§‹ç¬¬1æ­¥ï¼šåˆ›å»ºè¡¨ï¼** å¤åˆ¶ä¸Šé¢ç¬¬1æ­¥çš„SQLæ‰§è¡Œï¼

