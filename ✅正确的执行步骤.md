# ✅ 正确的执行步骤 - 复制粘贴即可

## 🎯 您遇到的错误

```
错误: 22P02: 类型uuid的输入语法无效: "你的user_id"
```

**原因**：您直接复制了 `'你的user_id'`，但这不是真实的UUID，需要替换！

---

## ⚡ 超级简单的解决方法

### 方法1：自动添加（最简单！）⭐⭐⭐

**直接复制下面的SQL，粘贴执行即可**：

```sql
-- 自动为当前登录用户创建团长
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
SELECT 
  auth.uid(),  -- 自动获取当前用户ID
  'gold',
  'TEST' || floor(random() * 1000)::text,  -- 自动生成邀请码
  5,
  15
WHERE NOT EXISTS (
  SELECT 1 FROM leaders WHERE user_id = auth.uid()
);
```

**说明**：
- `auth.uid()` 会自动获取你当前登录的用户ID
- 不需要手动替换任何东西
- 直接复制粘贴执行即可！

---

### 方法2：手动查询再添加（稍复杂）⭐⭐

#### 第1步：查询你的用户ID

```sql
SELECT id, email FROM auth.users;
```

**执行结果示例**：
```
id: 3dc76d22-4741-4c99-8c2d-b54a3d15fe5
email: zwq200394@qq.com
```

**复制那个ID**（鼠标选中→右键复制）

#### 第2步：添加团长（替换ID）

```sql
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
VALUES (
  '3dc76d22-4741-4c99-8c2d-b54a3d15fe5',  -- 粘贴你复制的ID
  'gold',
  'ABC123',
  5,
  15
);
```

**注意**：
- ⚠️ 必须用**单引号**包裹UUID
- ⚠️ 确保是完整的UUID（36个字符，包含连字符）
- ⚠️ 邀请码要唯一（如果重复会报错）

---

### 方法3：使用你的邮箱自动查找（推荐！）⭐⭐⭐

```sql
-- 用邮箱自动查找并添加
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
SELECT 
  id,
  'gold',
  'EMAIL' || floor(random() * 1000)::text,
  5,
  15
FROM auth.users
WHERE email = 'zwq200394@qq.com'  -- ⚠️ 改成你的邮箱
LIMIT 1;
```

**优点**：
- 不需要复制粘贴UUID
- 只需要输入你的邮箱
- 自动生成唯一邀请码

---

## 🎯 推荐执行顺序

### 第1步：检查表是否创建成功

```sql
-- 查看所有表
SELECT table_name FROM information_schema.tables 
WHERE table_schema = 'public' 
AND table_name LIKE 'leader%'
OR table_name = 'team_members';
```

**应该看到**：
- leaders
- team_members
- leader_commissions
- leader_levels

---

### 第2步：检查等级配置数据

```sql
SELECT * FROM leader_levels ORDER BY required_members;
```

**应该看到5条记录**：
```
bronze   | 青铜团长 | 0   | 5.00
silver   | 白银团长 | 10  | 8.00
gold     | 黄金团长 | 50  | 10.00
platinum | 铂金团长 | 100 | 12.00
diamond  | 钻石团长 | 200 | 15.00
```

---

### 第3步：添加自己为团长（用方法1）

**复制下面的SQL，直接执行**：

```sql
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
SELECT 
  auth.uid(),
  'gold',
  'AUTO' || floor(random() * 10000)::text,
  5,
  15
WHERE NOT EXISTS (
  SELECT 1 FROM leaders WHERE user_id = auth.uid()
);
```

**如果看到 "INSERT 0 1" 就成功了！**

---

### 第4步：验证是否添加成功

```sql
SELECT 
  id,
  user_id,
  level,
  invite_code,
  total_members,
  created_at
FROM leaders;
```

**应该能看到一条你的记录！**

---

### 第5步：（可选）添加一些测试成员

```sql
-- 查看所有用户
SELECT id, email FROM auth.users;

-- 如果有其他用户，可以添加为团队成员
-- 替换下面的两个ID
INSERT INTO team_members (leader_id, member_id, level, contribution)
SELECT 
  (SELECT id FROM leaders WHERE user_id = auth.uid()),  -- 你的团长ID
  '其他用户的user_id',  -- 替换成其他用户ID
  1,
  50.00;
```

---

### 第6步：（可选）添加测试佣金

```sql
-- 添加测试佣金记录
INSERT INTO leader_commissions (leader_id, type, amount, source_user_id, source_description)
SELECT 
  (SELECT id FROM leaders WHERE user_id = auth.uid()),
  'level1',
  50.00,
  auth.uid(),  -- 暂时用自己的ID
  '测试佣金记录'
;
```

---

## 🔍 常见错误和解决

### 错误1：UUID格式无效

**错误提示**：
```
类型uuid的输入语法无效: "你的user_id"
```

**原因**：没有替换成真实的UUID

**解决**：使用方法1的自动SQL（`auth.uid()`）

---

### 错误2：邀请码重复

**错误提示**：
```
duplicate key value violates unique constraint
```

**原因**：邀请码已存在

**解决**：更换邀请码，比如改成 'TEST456'

---

### 错误3：用户已是团长

**提示**：
```
INSERT 0 0
```

**原因**：该用户已经在leaders表中了

**解决**：
```sql
-- 删除旧记录
DELETE FROM leaders WHERE user_id = auth.uid();

-- 然后重新添加
```

---

## 🎊 最简单的完整流程

### 直接复制下面的SQL，一次性执行：

```sql
-- ============================================
-- 一键配置：自动创建团长和测试数据
-- ============================================

-- 1. 为当前用户创建团长
INSERT INTO leaders (user_id, level, invite_code, level1_members, total_members)
SELECT 
  auth.uid(),
  'gold',
  'R8da6a3N',  -- 你在截图中看到的邀请码
  2,  -- 你看到的成员数
  2
WHERE NOT EXISTS (SELECT 1 FROM leaders WHERE user_id = auth.uid())
RETURNING id, user_id, level, invite_code;

-- 2. 添加一个测试佣金记录
INSERT INTO leader_commissions (leader_id, type, amount, source_user_id, source_description)
SELECT 
  id,
  'level1',
  50.00,
  user_id,
  '测试佣金 - 来自系统'
FROM leaders
WHERE user_id = auth.uid();

-- 3. 验证数据
SELECT 
  '团长信息' as 表名, 
  (SELECT COUNT(*) FROM leaders WHERE user_id = auth.uid()) as 记录数
UNION ALL
SELECT '佣金记录', 
  (SELECT COUNT(*) FROM leader_commissions WHERE leader_id IN (SELECT id FROM leaders WHERE user_id = auth.uid()));

-- 完成！
```

**说明**：
- ✅ 使用 `auth.uid()` 自动获取当前用户
- ✅ 使用你截图中的邀请码 `R8da6a3N`
- ✅ 设置团队人数为2（和你截图一致）
- ✅ 自动添加测试佣金

---

## ✅ 执行成功的标志

执行后应该看到：

```
表名      | 记录数
---------|-------
团长信息  | 1
佣金记录  | 1
```

说明已成功添加！

---

## 📝 验证查询

```sql
-- 查看你的团长信息
SELECT * FROM leaders WHERE user_id = auth.uid();

-- 查看你的佣金记录
SELECT * FROM leader_commissions 
WHERE leader_id = (SELECT id FROM leaders WHERE user_id = auth.uid());

-- 查看等级配置
SELECT * FROM leader_levels ORDER BY required_members;
```

---

## 🎯 下一步

数据库配置完成后：

1. ✅ 修改 `leader-database-connector.js` 中的配置
2. ✅ 在HTML页面中引入脚本
3. ✅ 刷新页面查看真实数据

**详细步骤** → 查看 `⭐快速配置指南-必读.md`

---

**现在立即执行上面的"一键配置"SQL！** 🚀

