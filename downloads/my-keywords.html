<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <title>æˆ‘çš„å…³é”®è¯ - KKæœç´¢ä»»åŠ¡å¹³å°</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ğŸ”§ æ·»åŠ Supabase SDKï¼Œå®ç°æ•°æ®åº“æ•°æ®åŒæ­¥ -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Keyword Sync Manager -->
    <script src="keyword-sync-manager.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding: 16px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .navbar .back-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .navbar .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .navbar .title {
            color: white;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
        }
        
        .navbar .title i {
            margin-right: 8px;
        }
        
        .navbar .actions {
            display: flex;
            gap: 12px;
        }
        
        .navbar .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .navbar .action-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ */
        .stats-container {
            padding: 16px 16px 12px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 12px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 16px 12px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }
        
        .stat-card.active {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: white;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
        }
        
        /* æœç´¢æ  */
        .search-container {
            padding: 0 20px 20px;
        }
        
        .search-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            backdrop-filter: blur(10px);
        }
        
        .search-box i {
            color: #9ca3af;
            font-size: 16px;
        }
        
        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 16px;
            color: #374151;
        }
        
        .search-box input::placeholder {
            color: #9ca3af;
        }
        
        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            background: white;
            border-radius: 24px 24px 0 0;
            min-height: calc(100vh - 200px);
            padding: 18px 16px 84px;
            margin-top: 12px;
            position: relative;
        }
        
        /* å…³é”®è¯å¡ç‰‡ */
        .keyword-card { background:white; border-radius:16px; padding:12px; margin-bottom:10px; box-shadow:0 2px 14px rgba(0,0,0,.06); border:1px solid rgba(0,0,0,.05); transition:all .3s ease; position:relative; overflow:hidden; }
        /* å¼¹çª—åŸºç¡€æ ·å¼ */
        .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:none; z-index:9999; }
        .modal-content{ background:#fff; border-radius:12px; width:90%; max-width:520px; box-shadow:0 12px 40px rgba(0,0,0,.25); overflow:hidden; position:relative; }
        .modal-content.fullscreen{ width:100%; max-width:none; height:100%; border-radius:0; display:flex; flex-direction:column; }
        .modal-header{ display:flex; align-items:center; justify-content:space-between; padding:16px 18px; border-bottom:1px solid #eee; }
        .modal-header.gradient{ background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; border-bottom:none; }
        .modal-title{ display:flex; align-items:center; gap:10px; font-size:18px; font-weight:700; }
        .modal-sub{ font-size:12px; opacity:.9; margin-left:28px; margin-top:4px; }
        .modal-body{ padding:16px 18px; max-height:70vh; overflow:auto; }
        .modal-body.fill{ flex:1; background:linear-gradient(180deg,#f7f8fc 0%, #fbfcff 40%, #f7f8fc 100%); max-height:none; }
        .modal-footer{ display:flex; gap:10px; justify-content:flex-end; padding:12px 16px; border-top:1px solid #eee; }
        .action-bar{ position:sticky; bottom:0; background:#fff; border-top:1px solid #e5e7eb; padding:12px 16px; display:flex; gap:10px; justify-content:flex-end; }
        .close-btn{ background:none; border:none; font-size:20px; cursor:pointer; }

        /* é«˜çº§è¡¨å• */
        .form-grid{ display:grid; grid-template-columns:1fr; gap:12px; }
        .form-group .form-input{ border:1px solid #e5e7eb; background:#fff; border-radius:12px; padding:14px 16px; font-size:15px; box-shadow:0 2px 6px rgba(0,0,0,.04); transition:all .2s ease; color:#0f172a; }
        .form-group .form-input:focus{ outline:none; border-color:#7c8cf8; box-shadow:0 0 0 4px rgba(124,140,248,.15); }
        .form-group .form-input::placeholder{ color:#9aa4bd; }
        .form-label{ font-weight:600; color:#334155; margin-bottom:6px; display:block; }
        .hint{ font-size:12px; color:#718096; margin-top:6px; }
        .btn-primary{ background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; box-shadow:0 8px 20px rgba(102,126,234,.35); }
        .btn-primary:hover{ filter:brightness(1.07); transform:translateY(-1px); }
        .btn{ border-radius:10px; padding:10px 16px; }

        /* å®¹å™¨ç¾åŒ– */
        .form-shell{ max-width:980px; margin:0 auto; }
        .form-card{ background:#fff; border-radius:16px; padding:18px; box-shadow:0 10px 24px rgba(0,0,0,.08); border:1px solid #eef2f7; }
        .tips-card, .preview-card{ background:#fff; border-radius:16px; padding:16px; box-shadow:0 8px 20px rgba(0,0,0,.06); border:1px solid #eef2f7; }
        .tips-card h4, .preview-card h4{ margin:0 0 10px 0; font-size:14px; color:#334155; font-weight:700; }
        .tip-list{ list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:8px; }
        .tip-list li{ display:flex; align-items:flex-start; gap:8px; color:#475569; font-size:13px; }
        .tip-list li i{ color:#22c55e; margin-top:2px; }
        .preview-item{ display:flex; justify-content:space-between; gap:12px; padding:8px 10px; border-radius:10px; background:#f8fafc; border:1px dashed #e2e8f0; font-size:13px; color:#0f172a; }
        .preview-item .key{ color:#64748b; }

        /* å†…å®¹ä¸¤åˆ—å¸ƒå±€ï¼ˆå¤§å±ï¼‰ */
        .content-grid{ display:grid; grid-template-columns:1fr; gap:16px; }
        @media (min-width: 1100px){ .content-grid{ grid-template-columns: 2.2fr 1fr; } }

        /* å›¾æ ‡è¾“å…¥æ¡† */
        .input-with-icon{ position:relative; }
        .input-with-icon .input-icon{ position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#9aa4bd; font-size:14px; }
        .input-with-icon .form-input{ padding-left:36px; }
        /* å³ä¾§ä¸‹æ‹‰æŒ‡ç¤ºå™¨ï¼šå¤–ç½®ä½†å¯ç‚¹å‡»ï¼ˆé€æ˜æŒ‰é’®è¦†ç›–è§¦å‘å±•å¼€ï¼‰ */
        .select-field{ position:relative; border:1px solid #c9d1ff; border-radius:12px; box-shadow:0 2px 8px rgba(102,126,234,.12); background:#fff; }
        .select-field .dropdown-proxy{ position:absolute; right:8px; top:50%; transform:translateY(-50%); width:26px; height:26px; border-radius:6px; background:#eef2ff; border:1px solid #d7ddff; box-shadow:0 2px 6px rgba(102,126,234,.18); display:flex; align-items:center; justify-content:center; cursor:pointer; z-index:3; }
        .select-field .dropdown-proxy svg{ width:18px; height:18px; fill:#667eea; transition:transform .18s ease; }
        .select-field.cs-open .dropdown-proxy svg{ transform:rotate(180deg); }
        .select-field .dropdown-hotspot{ display:none; }

        /* Select ç¾åŒ– */
        /* ç´«è“ä¸»é¢˜ä¸‹æ‹‰ï¼ˆå¤–ç½®æŒ‡ç¤ºå™¨ï¼‰ */
        select.form-input{ appearance:none; -webkit-appearance:none; -moz-appearance:none; padding-right:16px; background-color:#fff; border:1px solid #c9d1ff; box-shadow:0 2px 8px rgba(102,126,234,.12); }
        /* ä¸‹æ‹‰åœ¨å¤–ç½®åŒ…è£¹å†…æ—¶ï¼Œå»æ‰è‡ªèº«è¾¹æ¡†å’Œé˜´å½±ï¼Œä¿è¯è¾¹æ¡†ä¸€ä½“åŒ– */
        .select-field select.form-input{ display:none; }

        /* è‡ªå®šä¹‰é€‰æ‹©æ¡†ï¼ˆå¸¦ä¸‹æ»‘é¢æ¿åŠ¨ç”»ï¼‰ */
        .cs-display{ height:44px; line-height:44px; padding:0 54px 0 36px; border-radius:12px; color:#0f172a; }
        .cs-options{ position:absolute; left:-1px; right:-1px; top:calc(100% + 6px); background:#fff; border:1px solid #c9d1ff; border-radius:12px; box-shadow:0 12px 28px rgba(102,126,234,.18); overflow:hidden; max-height:0; opacity:0; transform:translateY(-8px); transition:max-height .22s ease, opacity .18s ease, transform .18s ease; z-index:5; }
        .cs-options ul{ list-style:none; padding:6px 0; margin:0; }
        .cs-options li{ padding:10px 14px; cursor:pointer; color:#334155; }
        .cs-options li:hover{ background:#eef2ff; color:#0f172a; }
        .select-field.cs-open .cs-options{ max-height:240px; opacity:1; transform:translateY(0); }
        select.form-input:hover{ border-color:#aebaff; box-shadow:0 4px 12px rgba(102,126,234,.18); }
        select.form-input:focus{ border-color:#7c8cf8; box-shadow:0 0 0 4px rgba(124,140,248,.20); }
        /* ä¸‹æ‹‰é€‰é¡¹å­—ä½“é¢œè‰² */
        select.form-input option{ color:#0f172a; }

        /* èƒŒæ™¯è£…é¥° */
        .modal-content.fullscreen:before{ content:""; position:absolute; inset:-10%; background:radial-gradient(700px 300px at 10% -10%, rgba(102,126,234,.20), transparent 60%), radial-gradient(500px 260px at 90% 10%, rgba(118,75,162,.18), transparent 65%); filter:blur(10px); pointer-events:none; }

        /* å¤§å±ä¸¤åˆ— */
        @media (min-width: 920px){
            .form-grid{ grid-template-columns:1fr 1fr; }
            .form-grid .span-2{ grid-column:span 2; }
        }
        
        .keyword-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }
        
        .keyword-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
        }
        
        .keyword-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px; }
        
        .keyword-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar { width:40px; height:40px; border-radius:50%; background:linear-gradient(135deg,#667eea,#764ba2); display:flex; align-items:center; justify-content:center; color:#fff; font-size:18px; font-weight:600; }
        
        .user-info h3 { font-size:15px; font-weight:600; color:#2d3748; margin-bottom:2px; }
        
        .user-info p { font-size:11px; color:#718096; }
        
        .status-badge { padding:4px 10px; border-radius:16px; font-size:11px; font-weight:600; display:flex; align-items:center; gap:4px; min-width:72px; justify-content:center; }
        
        .status-pending {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #f59e0b;
        }
        
        .status-passed {
            background: linear-gradient(135deg, #d1fae5, #a7f3d0);
            color: #065f46;
            border: 1px solid #10b981;
        }
        
        .status-rejected {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            color: #991b1b;
            border: 1px solid #ef4444;
        }
        
        .keyword-details { background:linear-gradient(135deg,#f8fafc,#ffffff); border-radius:12px; padding:10px; margin-bottom:10px; }
        
        .detail-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
        
        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .detail-label { font-size:11px; color:#6b7280; font-weight:500; }
        
        .detail-value { font-size:13px; color:#374151; font-weight:600; }
        
        /* ç´§å‡‘å‹æ ‡ç­¾å¸ƒå±€ */
        .tag-row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 6px 0;
        }
        
        .info-tag {
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            padding: 4px 10px;
            font-size: 12px;
            color: #374151;
            white-space: nowrap;
        }
        
        .info-tag .tag-label {
            font-weight: 500;
            color: #6b7280;
            margin-right: 4px;
        }
        
        .info-tag .tag-value {
            font-weight: 600;
            color: #374151;
        }
        
        /* å…³é”®è¯æ˜¾ç¤ºåŒºåŸŸ */
        .keyword-display { background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:8px; margin:8px 0; position:relative; }
        
        .keyword-display .keyword-label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
            margin-bottom: 6px;
        }
        
        .keyword-display .keyword-text { font-size:14px; font-weight:700; color:#667eea; word-break:break-all; line-height:1.3; padding-right:32px; }
        
        .copy-btn { position:absolute; top:50%; right:10px; transform:translateY(-50%); width:24px; height:24px; border:none; background:#667eea; color:#fff; border-radius:6px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:12px; transition:all .3s ease; }
        
        .copy-btn:hover {
            background: #5b21b6;
            transform: translateY(-50%) scale(1.05);
        }
        
        .copy-btn:active {
            transform: translateY(-50%) scale(0.95);
        }
        
        .copy-btn.copied {
            background: #10b981;
        }
        
        .copy-btn.copied::after {
            content: 'âœ“';
            position: absolute;
        }
        
        /* å…³é”®è¯çŠ¶æ€æ˜¾ç¤ºæ ·å¼ */
        .keyword-display.pending {
            background: #fef3c7;
            border: 1px solid #f59e0b;
        }
        
        .keyword-display.pending .keyword-text.status-text {
            color: #d97706;
            font-weight: 600;
        }
        
        .keyword-display.rejected {
            background: #fee2e2;
            border: 1px solid #ef4444;
        }
        
        .keyword-display.rejected .keyword-text.status-text {
            color: #dc2626;
            font-weight: 600;
        }
        
        .status-icon {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            color: inherit;
            font-size: 14px;
            opacity: 0.7;
        }
        
        .keyword-display.pending .status-icon {
            color: #d97706;
        }
        
        .keyword-display.rejected .status-icon {
            color: #dc2626;
        }
        
        /* ID æ˜¾ç¤ºä¼˜åŒ– */
        .id-display { background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:6px 10px; margin:10px 0; display:flex; align-items:center; justify-content:space-between; }
        
        .id-display .id-label { font-size:11px; color:#6b7280; font-weight:500; }
        
        .id-display .id-value { font-size:12px; color:#374151; font-weight:600; font-family:'Monaco','Menlo',monospace; }
        
        .keyword-actions { display:flex; gap:6px; margin-top:8px; }
        
        .action-btn { padding:6px 12px; border-radius:10px; font-size:13px; font-weight:500; cursor:pointer; transition:all .3s ease; border:none; display:flex; align-items:center; gap:6px; }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        
        .btn-secondary:hover {
            background: #e2e8f0;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }
        
        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            color: #d1d5db;
        }
        
        .empty-state h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }
        
        .empty-state p {
            font-size: 16px;
            margin-bottom: 24px;
        }
        
        /* åº•éƒ¨æ·»åŠ æŒ‰é’® */
        .floating-action {
            position: fixed;
            bottom: 18px;
            left: 20px;
            right: 20px;
            z-index: 99;
        }
        
        .add-keyword-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 16px 24px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.4);
        }
        
        .add-keyword-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.5);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 28px;
        }
        
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 480px) {
            .stats-container {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .stat-card {
                padding: 12px 8px;
            }
            
            .stat-number {
                font-size: 20px;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* ç­›é€‰æ ‡ç­¾æ ·å¼ */
        .filter-indicator {
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: white;
            border-radius: 1px;
        }
        
        /* éšè—æ—§ç‰ˆç´«è‰²åŒºåŸŸï¼ˆé¡¶éƒ¨æ ‡ç­¾/æœç´¢/é™æ€åˆ—è¡¨ï¼‰ï¼Œä¿ç•™åº•éƒ¨â€œç”³è¯·æ–°å…³é”®è¯â€æŒ‰é’® */
        body > div.bg-white.px-4.pt-2,
        body > div.p-4.flex.items-center,
        body > div.bg-white.rounded-lg.mx-4.overflow-hidden.shadow-sm {
            display: none !important;
        }

        /* ç®€æ´æ¨¡å¼ï¼šéšè— ç”³è¯·IDã€ç»éªŒã€æ¸ é“ */
        .id-display { display: none !important; }
        .tag-row .info-tag:nth-child(1), /* ç»éªŒ */
        .tag-row .info-tag:nth-child(2)  /* æ¸ é“ */{ display: none !important; }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                </button>
        <h1 class="title">
            <i class="fas fa-key"></i>
            æˆ‘çš„å…³é”®è¯
        </h1>
        <div class="actions">
            <button class="action-btn" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i>
                </button>
            <button class="action-btn" onclick="showSettings()">
                    <i class="fas fa-cog"></i>
                </button>
        </div>
    </nav>
    
    <!-- ç»Ÿè®¡å¡ç‰‡åŒºåŸŸ -->
    <div class="stats-container">
        <div class="stat-card active" data-filter="all" onclick="filterKeywords('all', this)">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">å…¨éƒ¨</div>
            </div>
        <div class="stat-card" data-filter="pending" onclick="filterKeywords('pending', this)">
            <div class="stat-number" id="pendingCount">0</div>
            <div class="stat-label">å¾…å®¡æ ¸</div>
            </div>
        <div class="stat-card" data-filter="passed" onclick="filterKeywords('passed', this)">
            <div class="stat-number" id="passedCount">0</div>
            <div class="stat-label">å·²é€šè¿‡</div>
            </div>
        <div class="stat-card" data-filter="rejected" onclick="filterKeywords('rejected', this)">
            <div class="stat-number" id="rejectedCount">0</div>
            <div class="stat-label">æœªé€šè¿‡</div>
        </div>
    </div>
    
    <!-- æœç´¢æ ï¼ˆæŒ‰éœ€æ±‚ç§»é™¤æ˜¾ç¤ºï¼‰ -->
    <!--
    <div class="search-container">
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" placeholder="æœç´¢å…³é”®è¯ã€ç”¨æˆ·åæˆ–æ¨å¹¿æ¸ é“" id="searchInput">
            <button onclick="clearSearch()" id="clearBtn" style="display: none;">
                <i class="fas fa-times" style="color: #9ca3af;"></i>
            </button>
        </div>
    </div>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸï¼ˆæŒ‰éœ€æ±‚ç§»é™¤æ˜¾ç¤ºï¼‰ -->
    <main class="main-content">
        <div id="keywordsContainer">
            <div class="loading" id="loadingState">
                <div class="loader"></div>
            </div>
        </div>
    </main>
    -->
    
    <!-- åº•éƒ¨æ·»åŠ æŒ‰é’® -->
    <div class="floating-action">
        <button class="add-keyword-btn" onclick="addNewKeyword()">
            <i class="fas fa-plus"></i>
            ç”³è¯·æ–°å…³é”®è¯
        </button>
    </div>
    
    <script>
        // ğŸ”§ æ–°å¢ï¼šSupabaseé…ç½®å’Œåˆå§‹åŒ–
        let supabase = null;
        const SUPABASE_URL = 'https://ybrveusbwjusnrzgfnok.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlicnZldXNid2p1c25yemdmbm9rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0ODU1NjIsImV4cCI6MjA3MjA2MTU2Mn0.JKPSUli-q9wRuDagE6kwltLk9XgfygE8yznm-Ca82Qk';
        
        // åˆå§‹åŒ–Supabaseå®¢æˆ·ç«¯
        function initSupabase() {
            try {
                if (typeof window.supabase !== 'undefined') {
                    supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    console.log('âœ… Supabaseå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
                    return true;
                } else {
                    console.error('âŒ Supabase SDKæœªåŠ è½½');
                    return false;
                }
            } catch (error) {
                console.error('âŒ Supabaseåˆå§‹åŒ–å¤±è´¥:', error);
                return false;
            }
        }
        
        // åº”ç”¨çŠ¶æ€ç®¡ç†
        const appState = {
            currentFilter: 'all',
            searchQuery: '',
            keywords: [],
            currentUser: null
        };
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            const params = new URLSearchParams(window.location.search);
            // è®°å½•æ¥æºä»»åŠ¡ï¼škk | xray | wk
            appState.sourceTask = params.get('task') || 'kk';
            
            // æ ¹æ®ä»»åŠ¡ç±»å‹æ›´æ–°é¡µé¢æ ‡é¢˜
            const titleMap = {
                'xray': 'æˆ‘çš„å…³é”®è¯ - xé›·æµè§ˆå™¨æœç´¢',
                'wk': 'æˆ‘çš„å…³é”®è¯ - æ‚Ÿç©ºæœç´¢',
                'kk': 'æˆ‘çš„å…³é”®è¯ - KKæœç´¢ä»»åŠ¡',
                'kkdisk': 'æˆ‘çš„å…³é”®è¯ - KKç½‘ç›˜'
            };
            document.title = titleMap[appState.sourceTask] || 'æˆ‘çš„å…³é”®è¯ - KKæœç´¢ä»»åŠ¡å¹³å°';
            
            // æ›´æ–°é¡µé¢æ˜¾ç¤ºçš„æ ‡é¢˜
            const headerTitle = document.querySelector('.title');
            if (headerTitle) {
                const taskNames = {
                    'xray': 'xé›·æµè§ˆå™¨æœç´¢',
                    'wk': 'æ‚Ÿç©ºæœç´¢', 
                    'kk': 'KKæœç´¢',
                    'kkdisk': 'KKç½‘ç›˜'
                };
                headerTitle.innerHTML = `<i class="fas fa-key"></i>æˆ‘çš„å…³é”®è¯ï¼ˆ${taskNames[appState.sourceTask] || 'KKæœç´¢'}ï¼‰`;
            }
            
            initializePage();
        });
        
        // åˆå§‹åŒ–é¡µé¢
        async function initializePage() {
            // ğŸ”§ ä¿®å¤ï¼šä¼˜å…ˆåˆå§‹åŒ–Supabaseï¼Œå»¶è¿Ÿæ‰§è¡Œç¡®ä¿SDKåŠ è½½
            setTimeout(() => {
                const supabaseReady = initSupabase();
                if (!supabaseReady) {
                    console.warn('âš ï¸ Supabaseåˆå§‹åŒ–å¤±è´¥ï¼Œå°†åªèƒ½ä½¿ç”¨æœ¬åœ°æ•°æ®');
                } else {
                    // ğŸ”§ Supabaseåˆå§‹åŒ–æˆåŠŸåï¼Œè®¾ç½®è‡ªåŠ¨åˆ·æ–°
                    setupAutoRefresh();
                }
            }, 500);
            
            // ç¡®ä¿ç”¨æˆ·ç™»å½•çŠ¶æ€
            appState.currentUser = ensureUserLogin();
            
            // åŠ è½½å…³é”®è¯æ•°æ®ï¼ˆç°åœ¨æ”¯æŒä»æ•°æ®åº“åŠ è½½ï¼‰
            await loadKeywords();

            // ç›‘å¬åå°â€œå…³é”®è¯å¤±æ•ˆâ€æ¨é€ï¼ˆé€šè¿‡localStorageäº‹ä»¶ï¼‰
            try{
                window.addEventListener('storage', function(e){
                    if(e && e.key && e.key.startsWith('invalid_keywords_updated')){
                        showToast('æ‚¨æœ‰å…³é”®è¯è¢«æ ‡è®°ä¸ºå¤±æ•ˆï¼Œæ— æ³•ç»“ç®—æ”¶ç›Šï¼Œè¯·é‡æ–°ç”³è¯·æ–°çš„å…³é”®è¯', 'error');
                        loadKeywords();
                    }
                });
            }catch(_){ }
            
            // è®¾ç½®æœç´¢ç›‘å¬
            // æœç´¢åŒºåŸŸå·²ç§»é™¤ï¼Œä¸å†åˆå§‹åŒ–
            // setupSearch();
            
            // åˆå§‹åŒ–åŠ¨ç”»
            document.body.classList.add('fade-in');
        }
        
        // ğŸ”§ ä¿®å¤ï¼šç¡®ä¿ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼Œä½¿ç”¨ç¨³å®šçš„ç”¨æˆ·ID
        function ensureUserLogin() {
            let currentUser = getCurrentUser();
            
            // ğŸ”§ ä¿®å¤ï¼šå¦‚æœæ²¡æœ‰ç”¨æˆ·æˆ–ç”¨æˆ·IDä¸æ˜¯ç»Ÿä¸€æ ¼å¼ï¼Œåˆ›å»º/ä½¿ç”¨ç»Ÿä¸€ç”¨æˆ·
            if (!currentUser || !currentUser.id || currentUser.id.startsWith('temp_') || currentUser.id.startsWith('user_')) {
                console.log('ğŸ”§ åˆ›å»ºç¨³å®šç”¨æˆ·IDä»¥è§£å†³æ•°æ®ä¸ä¸€è‡´é—®é¢˜');
                
                // å°è¯•ä»ç°æœ‰æ•°æ®ä¸­æ¢å¤ç”¨æˆ·ä¿¡æ¯
                const existingUserInfo = findExistingUserInfo();
                
                const stableUser = {
                    id: '555', // ğŸ”§ ç»Ÿä¸€æ ¼å¼ï¼šä½¿ç”¨"555"ä¸ç”³è¯·é¡µé¢ä¿æŒä¸€è‡´
                    username: '555', // ğŸ”§ ç»Ÿä¸€ç”¨æˆ·å
                    isTemp: false,
                    created_at: new Date().toISOString(),
                    migrated: true // æ ‡è®°ä¸ºå·²è¿ç§»
                };
                
                localStorage.setItem('currentUser', JSON.stringify(stableUser));
                currentUser = stableUser;
                
                // ğŸ”§ è¿ç§»ç°æœ‰æ•°æ®åˆ°ç¨³å®šç”¨æˆ·IDä¸‹
                migrateExistingData(currentUser.id);
                
                console.log('âœ… ç¨³å®šç”¨æˆ·åˆ›å»ºå®Œæˆ:', currentUser);
            }
            
            return currentUser;
        }
        
        // ğŸ”§ æ–°å¢ï¼šæŸ¥æ‰¾ç°æœ‰ç”¨æˆ·ä¿¡æ¯
        function findExistingUserInfo() {
            try {
                // æŸ¥æ‰¾æ‰€æœ‰å…³é”®è¯æ•°æ®ï¼Œæå–ç”¨æˆ·ä¿¡æ¯
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('keywords_')) {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (Array.isArray(data) && data.length > 0) {
                            const firstRecord = data[0];
                            if (firstRecord.username && firstRecord.username !== 'æ¸¸å®¢ç”¨æˆ·') {
                                console.log('ğŸ” ä»ç°æœ‰æ•°æ®ä¸­æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯:', firstRecord.username);
                                return {
                                    username: '555', // ğŸ”§ ç»Ÿä¸€ç”¨æˆ·å
                                    id: '555' // ğŸ”§ ç»Ÿä¸€IDæ ¼å¼ï¼Œå»æ‰user_å‰ç¼€
                                };
                            }
                        }
                    }
                }
                
                // å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œè¿”å›ç»Ÿä¸€çš„é»˜è®¤ä¿¡æ¯
                return { username: '555', id: '555' }; // ğŸ”§ ç»Ÿä¸€IDæ ¼å¼
            } catch (error) {
                console.warn('æŸ¥æ‰¾ç°æœ‰ç”¨æˆ·ä¿¡æ¯å¤±è´¥:', error);
                return { username: '555', id: '555' }; // ğŸ”§ ç»Ÿä¸€IDæ ¼å¼
            }
        }
        
        // ğŸ”§ æ–°å¢ï¼šè¿ç§»ç°æœ‰æ•°æ®åˆ°ç¨³å®šç”¨æˆ·ID
        function migrateExistingData(stableUserId) {
            try {
                const targetKey = `keywords_${stableUserId}`;
                let targetData = JSON.parse(localStorage.getItem(targetKey) || '[]');
                let migratedCount = 0;
                
                // æŸ¥æ‰¾æ‰€æœ‰éœ€è¦è¿ç§»çš„æ•°æ®
                const keysToMigrate = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('keywords_') && key !== targetKey) {
                        keysToMigrate.push(key);
                    }
                }
                
                // è¿ç§»æ•°æ®
                keysToMigrate.forEach(key => {
                    try {
                        const data = JSON.parse(localStorage.getItem(key));
                        if (Array.isArray(data)) {
                            data.forEach(item => {
                                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒIDçš„è®°å½•
                                const existingIndex = targetData.findIndex(existing => existing.id === item.id);
                                if (existingIndex === -1) {
                                    // æ›´æ–°è®°å½•çš„ç”¨æˆ·ID
                                    item.userId = stableUserId;
                                    targetData.push(item);
                                    migratedCount++;
                                }
                            });
                        }
                        // åˆ é™¤æ—§é”®
                        localStorage.removeItem(key);
                        console.log(`ğŸ”„ å·²è¿ç§»æ•°æ®é”®: ${key}`);
                    } catch (e) {
                        console.warn(`è¿ç§»æ•°æ®å¤±è´¥: ${key}`, e);
                    }
                });
                
                // ä¿å­˜åˆå¹¶åçš„æ•°æ®
                if (migratedCount > 0) {
                    localStorage.setItem(targetKey, JSON.stringify(targetData));
                    console.log(`âœ… æ•°æ®è¿ç§»å®Œæˆï¼Œè¿ç§»äº† ${migratedCount} æ¡è®°å½•åˆ° ${targetKey}`);
                }
                
            } catch (error) {
                console.error('æ•°æ®è¿ç§»å¤±è´¥:', error);
            }
        }

        // è·å–å½“å‰ç”¨æˆ·
        function getCurrentUser() {
            try {
                const currentUser = localStorage.getItem('currentUser');
                return currentUser ? JSON.parse(currentUser) : null;
            } catch (error) {
                return null;
            }
        }
        
        // ğŸ”§ ä¿®å¤ï¼šåŠ è½½å…³é”®è¯æ•°æ®ï¼Œä¼˜å…ˆä»æ•°æ®åº“è¯»å–
        async function loadKeywords() {
            try {
                // æ¨¡æ‹ŸåŠ è½½å»¶æ—¶
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // ğŸ”§ ä¿®å¤ï¼šä¼˜å…ˆä»æ•°æ®åº“è·å–æ•°æ®
                let keywords = [];
                let dataSource = 'localStorage';
                
                if (supabase && appState.currentUser) {
                    console.log('ğŸ“¡ ä¼˜å…ˆä»æ•°æ®åº“åŠ è½½å…³é”®è¯æ•°æ®...');
                    try {
                        const { data: dbKeywords, error } = await supabase
                            .from('keyword_applications')
                            .select('*')
                            .eq('user_id', appState.currentUser.id)
                            .eq('task_type', appState.sourceTask === 'xray' ? 'xé›·æµè§ˆå™¨æœç´¢ä»»åŠ¡' : (appState.sourceTask==='wk' ? 'æ‚Ÿç©ºæœç´¢ä»»åŠ¡' : (appState.sourceTask==='kkdisk' ? 'KKç½‘ç›˜ä»»åŠ¡' : 'KKæœç´¢ä»»åŠ¡')))
                            .order('created_at', { ascending: false });
                        
                        if (!error && dbKeywords && dbKeywords.length > 0) {
                            // è½¬æ¢æ•°æ®åº“æ•°æ®æ ¼å¼ä»¥åŒ¹é…å‰ç«¯æ˜¾ç¤º
                            keywords = dbKeywords.map(app => ({
                                id: app.id,
                                username: app.username,
                                userId: app.user_id,
                                experience: app.experience,
                                channel: app.promotion_channel,
                                category: app.task_type || 'å…³é”®è¯æ¨å¹¿',
                                keywords: app.keywords,
                                status: app.status,
                                assigned_keywords: app.assigned_keywords,
                                reject_reason: app.reject_reason,
                                reject_note: app.reject_note,
                                approve_note: app.approve_note,
                                submitTime: app.created_at,
                                created_at: app.created_at,
                                updated_at: app.updated_at
                            }));
                            
                            dataSource = 'database';
                            console.log(`âœ… ä»æ•°æ®åº“æˆåŠŸåŠ è½½äº† ${keywords.length} æ¡å…³é”®è¯è®°å½•`);
                            
                            // åŒæ­¥åˆ°localStorageä½œä¸ºå¤‡ä»½
                            syncToLocalStorage(appState.currentUser.id, keywords);
                        } else if (error) {
                            console.warn('âš ï¸ æ•°æ®åº“æŸ¥è¯¢å¤±è´¥:', error);
                        }
                    } catch (dbError) {
                        console.warn('âš ï¸ æ•°æ®åº“è¿æ¥å¼‚å¸¸:', dbError);
                    }
                }
                
                // å¦‚æœæ•°æ®åº“æ²¡æœ‰æ•°æ®æˆ–è¿æ¥å¤±è´¥ï¼Œä»localStorageè¯»å–
                if (keywords.length === 0) {
                    console.log('ğŸ”„ ä»localStorageåŠ è½½å…³é”®è¯æ•°æ®...');
                    keywords = getUserKeywords(appState.currentUser.id);
                    // ä¾æ®ä»»åŠ¡æ¥æºè¿‡æ»¤ï¼š
                    // - xray è§†å›¾ï¼šåªå±•ç¤ºæ˜ç¡®ä¸º xé›· çš„è®°å½•
                    // - kk è§†å›¾ï¼šå±•ç¤º KK æˆ–æ—  task_type çš„æ—§è®°å½•
                    if (appState.sourceTask === 'xray') {
                        keywords = keywords.filter(k => k.task_type === 'xé›·æµè§ˆå™¨æœç´¢ä»»åŠ¡');
                    } else if (appState.sourceTask === 'wk') {
                        keywords = keywords.filter(k => k.task_type === 'æ‚Ÿç©ºæœç´¢ä»»åŠ¡');
                    } else if (appState.sourceTask === 'kkdisk') {
                        keywords = keywords.filter(k => k.task_type === 'KKç½‘ç›˜ä»»åŠ¡');
                    } else {
                        keywords = keywords.filter(k => k.task_type === 'KKæœç´¢ä»»åŠ¡');
                    }
                    dataSource = 'localStorage';
                }
                
                appState.keywords = keywords;
                console.log(`ğŸ“Š æœ€ç»ˆåŠ è½½äº† ${keywords.length} æ¡è®°å½•ï¼Œæ•°æ®æº: ${dataSource}`);
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                updateStats(keywords);
                
                // æ¸²æŸ“å…³é”®è¯åˆ—è¡¨
                renderKeywords(keywords);
                
            } catch (error) {
                console.error('åŠ è½½å…³é”®è¯å¤±è´¥:', error);
                showError('åŠ è½½å…³é”®è¯æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•');
            }
        }
        
        // ğŸ”§ æ–°å¢ï¼šå°†æ•°æ®åº“æ•°æ®åŒæ­¥åˆ°localStorageä½œä¸ºå¤‡ä»½
        function syncToLocalStorage(userId, keywords) {
            try {
                const keywordKey = `keywords_${userId}`;
                localStorage.setItem(keywordKey, JSON.stringify(keywords));
                console.log(`ğŸ’¾ å·²åŒæ­¥ ${keywords.length} æ¡è®°å½•åˆ°localStorageå¤‡ä»½`);
            } catch (error) {
                console.warn('åŒæ­¥åˆ°localStorageå¤±è´¥:', error);
            }
        }
        
        // è·å–ç”¨æˆ·å…³é”®è¯
        function getUserKeywords(userId) {
            try {
                const keywordKey = `keywords_${userId}`;
                const keywords = localStorage.getItem(keywordKey);
                const keywordArray = keywords ? JSON.parse(keywords) : [];
                
                // ğŸ”§ ä¿®å¤ï¼šæŒ‰æäº¤æ—¶é—´é™åºæ’åºï¼Œæœ€æ–°è®°å½•åœ¨å‰é¢
                keywordArray.sort((a, b) => {
                    const timeA = new Date(a.submitTime || a.created_at || 0);
                    const timeB = new Date(b.submitTime || b.created_at || 0);
                    return timeB - timeA; // é™åºæ’åºï¼Œæœ€æ–°çš„åœ¨å‰é¢
                });
                
                console.log(`ğŸ“‹ ç”¨æˆ· ${userId} çš„å…³é”®è¯å·²æŒ‰æ—¶é—´æ’åºï¼Œå…± ${keywordArray.length} æ¡è®°å½•`);
                
                return keywordArray;
            } catch (error) {
                console.error('è·å–å…³é”®è¯å¤±è´¥:', error);
                return [];
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(keywords) {
            const totalCount = keywords.length;
            const pendingCount = keywords.filter(k => 
                k.status === 'pending' || k.status === 'å¾…å®¡æ ¸' || !k.status
            ).length;
            const passedCount = keywords.filter(k => 
                k.status === 'passed' || k.status === 'approved' || k.status === 'å·²é€šè¿‡'
            ).length;
            const rejectedCount = keywords.filter(k => 
                k.status === 'rejected' || k.status === 'å·²æ‹’ç»'
            ).length;
            
            document.getElementById('totalCount').textContent = totalCount;
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('passedCount').textContent = passedCount;
            document.getElementById('rejectedCount').textContent = rejectedCount;
        }
        
        // æ¸²æŸ“å…³é”®è¯åˆ—è¡¨
        function renderKeywords(keywords) {
            const container = document.getElementById('keywordsContainer');
            
            if (keywords.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-key"></i>
                        <h3>æš‚æ— å…³é”®è¯ç”³è¯·</h3>
                        <p>æ‚¨è¿˜æ²¡æœ‰ç”³è¯·è¿‡å…³é”®è¯ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹ç”³è¯·å§ï¼</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            keywords.forEach((keyword, index) => {
                if (shouldShowKeyword(keyword)) {
                    html += renderKeywordCard(keyword, index);
                }
            });
            
            if (html === '') {
                html = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç»“æœ</h3>
                        <p>è¯·å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶æˆ–æœç´¢å…³é”®è¯</p>
                        <button class="btn-secondary action-btn" onclick="clearFilters()" style="padding: 12px 24px; font-size: 16px;">
                            <i class="fas fa-undo"></i>
                            æ¸…é™¤ç­›é€‰
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }
        
        // åˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºå…³é”®è¯
        function shouldShowKeyword(keyword) {
            // çŠ¶æ€ç­›é€‰
            if (appState.currentFilter !== 'all') {
                const status = keyword.status || 'pending';
                let normalizedStatus = status;
                
                // æ ‡å‡†åŒ–çŠ¶æ€å€¼
                if (status === 'approved' || status === 'å·²é€šè¿‡') {
                    normalizedStatus = 'passed';
                } else if (status === 'å·²æ‹’ç»') {
                    normalizedStatus = 'rejected';
                } else if (status === 'å¾…å®¡æ ¸') {
                    normalizedStatus = 'pending';
                }
                
                if (normalizedStatus !== appState.currentFilter) {
                    return false;
                }
            }
            
            // æœç´¢ç­›é€‰
            if (appState.searchQuery) {
                const query = appState.searchQuery.toLowerCase();
                const searchText = [
                    keyword.username || '',
                    keyword.keyword || '',
                    keyword.assigned_keywords || '', // ğŸ”§ ä¿®å¤ï¼šåŒ…å«åˆ†é…çš„å…³é”®è¯
                    keyword.channel || '',
                    keyword.category || '',
                    keyword.id || ''
                ].join(' ').toLowerCase();
                
                if (!searchText.includes(query)) {
                    return false;
                }
            }
            
            return true;
        }
        
        // æ¸²æŸ“å…³é”®è¯å¡ç‰‡
        function renderKeywordCard(keyword, index) {
            const status = keyword.status || 'pending';
            const statusText = getStatusText(status);
            const statusClass = getStatusClass(status);
            const statusIcon = getStatusIcon(status);
            
            const channelText = getChannelText(keyword.channel);
            const categoryText = getCategoryText(keyword.category);
            const experienceText = getExperienceText(keyword.experience);
            
            return `
                <div class="keyword-card fade-in" style="animation-delay: ${index * 0.1}s">
                    <div class="keyword-header">
                        <div class="keyword-user">
                            <div class="user-avatar">
                                ${getAvatarText(keyword.username)}
                            </div>
                            <div class="user-info">
                                <h3>${keyword.username || 'æœªçŸ¥ç”¨æˆ·'}</h3>
                                <p>ç”³è¯·æ—¶é—´ï¼š${formatTime(keyword.submitTime)}</p>
                            </div>
                        </div>
                        <div class="status-badge ${statusClass}">
                            <i class="${statusIcon}"></i>
                            ${statusText}
                        </div>
                    </div>
                    
                    <div class="keyword-details">
                        <!-- ç”³è¯·IDæ˜¾ç¤º -->
                        <div class="id-display">
                            <span class="id-label">ç”³è¯·ID</span>
                            <span class="id-value">${keyword.id || 'KW' + Date.now().toString().slice(-6)}</span>
                        </div>
                        
                        <!-- æ¨å¹¿ä¿¡æ¯æ ‡ç­¾è¡Œ -->
                        <div class="tag-row">
                            <div class="info-tag">
                                <span class="tag-label">ç»éªŒ:</span>
                                <span class="tag-value">${experienceText}</span>
                            </div>
                            <div class="info-tag">
                                <span class="tag-label">æ¸ é“:</span>
                                <span class="tag-value">${channelText}</span>
                            </div>
                            <div class="info-tag">
                                <span class="tag-label">ç±»å‹:</span>
                                <span class="tag-value">${categoryText}</span>
                            </div>
                        </div>
                        
                        ${(() => {
                            // ğŸ”§ ä¿®å¤ï¼šä¸¥æ ¼çš„å…³é”®è¯æ˜¾ç¤ºé€»è¾‘
                            const isApproved = keyword.status === 'approved' || keyword.status === 'å·²é€šè¿‡';
                            const isPending = keyword.status === 'pending' || keyword.status === 'å¾…å®¡æ ¸';
                            const isRejected = keyword.status === 'rejected' || keyword.status === 'å·²æ‹’ç»';
                            const isInvalid = (keyword.approve_note||'').includes('å¤±æ•ˆ:');
                            
                            // åªæœ‰å®¡æ ¸é€šè¿‡ä¸”æœ‰ç®¡ç†å‘˜åˆ†é…çš„å…³é”®è¯æ—¶æ‰æ˜¾ç¤ºçœŸæ­£çš„å…³é”®è¯
                            if (isApproved && !isInvalid && keyword.assigned_keywords && keyword.assigned_keywords.trim() && appState.sourceTask!=='kkdisk') {
                                return `
                                    <div class="keyword-display">
                                        <div class="keyword-label">åˆ†é…å…³é”®è¯</div>
                                        <div class="keyword-text">${keyword.assigned_keywords}</div>
                                        <button class="copy-btn" onclick="copyKeyword(\`${keyword.assigned_keywords.replace(/\`/g, '\\`')}\`, this)" title="å¤åˆ¶å…³é”®è¯">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                `;
                            } else {
                                // å…¶ä»–æƒ…å†µï¼šå¾…å®¡æ ¸ã€å·²æ‹’ç»ã€æˆ–å·²é€šè¿‡ä½†æœªåˆ†é…å…³é”®è¯
                                let statusText = '';
                                let statusClass = '';
                                
                                if (isInvalid) {
                                    statusText = 'å…³é”®è¯å·²å¤±æ•ˆï¼Œæ— æ³•ç»“ç®—æ”¶ç›Šï¼Œè¯·é‡æ–°ç”³è¯·';
                                    statusClass = 'rejected';
                                } else if (isPending) {
                                    statusText = (appState.sourceTask==='kkdisk') ? 'ç­‰å¾…å®¡æ ¸' : 'å…³é”®è¯å¾…åˆ†é…';
                                    statusClass = 'pending';
                                } else if (isRejected) {
                                    statusText = 'ç”³è¯·å·²æ‹’ç»';
                                    statusClass = 'rejected';
                                } else if (isApproved) {
                                    statusText = (appState.sourceTask==='kkdisk') ? 'å®¡æ ¸é€šè¿‡' : 'å…³é”®è¯å¾…åˆ†é…';
                                    statusClass = (appState.sourceTask==='kkdisk') ? 'status-passed' : 'pending';
                                } else {
                                    statusText = 'å…³é”®è¯å¾…åˆ†é…';
                                    statusClass = 'pending';
                                }
                                
                                return `
                                    <div class="keyword-display ${statusClass}">
                                        <div class="keyword-label">å…³é”®è¯çŠ¶æ€</div>
                                        <div class="keyword-text status-text">${statusText}</div>
                                        <div class="status-icon">
                                            <i class="fas ${isInvalid ? 'fa-ban' : isPending ? 'fa-clock' : isRejected ? 'fa-times-circle' : 'fa-clock'}"></i>
                                        </div>
                                    </div>
                                `;
                            }
                        })()}
                        
                        ${(keyword.rejectReason || keyword.reject_reason) ? `
                            <div class="detail-item" style="margin-top: 12px;">
                                <div class="detail-label">æ‹’ç»åŸå› </div>
                                <div class="detail-value" style="color: #ef4444; font-weight: 600;">${keyword.rejectReason || keyword.reject_reason}</div>
                            </div>
                        ` : ''}
                        
                        ${(keyword.reject_note && (keyword.status === 'rejected' || keyword.status === 'å·²æ‹’ç»')) ? `
                            <div class="detail-item" style="margin-top: 8px;">
                                <div class="detail-label">è¯¦ç»†è¯´æ˜</div>
                                <div class="detail-value" style="color: #ef4444; font-size: 14px; line-height: 1.5;">${keyword.reject_note}</div>
                            </div>
                        ` : ''}
                        
                        ${(keyword.approve_note && (keyword.status === 'approved' || keyword.status === 'å·²é€šè¿‡')) ? `
                            <div class="detail-item" style="margin-top: 8px;">
                                <div class="detail-label">å®¡æ ¸å¤‡æ³¨</div>
                                <div class="detail-value" style="color: #10b981; font-size: 14px; line-height: 1.5;">${keyword.approve_note}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="keyword-actions">
                        ${getActionButtons(keyword)}
                    </div>
                    </div>
                `;
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            switch(status) {
                case 'approved':
                case 'passed': 
                case 'å·²é€šè¿‡': 
                    return 'å®¡æ ¸é€šè¿‡';
                case 'rejected':
                case 'å·²æ‹’ç»': 
                    return 'å®¡æ ¸æ‹’ç»';
                case 'pending':
                case 'å¾…å®¡æ ¸': 
                    return 'å®¡æ ¸ä¸­';
                default: 
                    return 'å®¡æ ¸ä¸­';
            }
        }

        // è·å–çŠ¶æ€æ ·å¼ç±»
        function getStatusClass(status) {
            switch(status) {
                case 'approved':
                case 'passed':
                case 'å·²é€šè¿‡': 
                    return 'status-passed';
                case 'rejected':
                case 'å·²æ‹’ç»': 
                    return 'status-rejected';
                case 'pending':
                case 'å¾…å®¡æ ¸': 
                    return 'status-pending';
                default: 
                    return 'status-pending';
            }
        }
        
        // è·å–çŠ¶æ€å›¾æ ‡
        function getStatusIcon(status) {
            switch(status) {
                case 'approved':
                case 'passed':
                case 'å·²é€šè¿‡': 
                    return 'fas fa-check-circle';
                case 'rejected':
                case 'å·²æ‹’ç»': 
                    return 'fas fa-times-circle';
                case 'pending':
                case 'å¾…å®¡æ ¸': 
                    return 'fas fa-clock';
                default: 
                    return 'fas fa-clock';
            }
        }
        
        // ğŸ”§ ä¿®å¤ï¼šè·å–æ¸ é“æ–‡æœ¬ - ç›´æ¥è¿”å›ç”¨æˆ·è¾“å…¥çš„ä¸­æ–‡æ•°æ®
        function getChannelText(channel) {
            // å¦‚æœå·²ç»æ˜¯ä¸­æ–‡ï¼Œç›´æ¥è¿”å›
            if (channel && typeof channel === 'string') {
                // å¤„ç†å¯èƒ½çš„æ—§ç‰ˆæœ¬è‹±æ–‡keyæ˜ å°„
                const channelMap = {
                    'douyin': 'æŠ–éŸ³å¹³å°',
                    'wechat': 'å¾®ä¿¡æœ‹å‹åœˆ',
                    'kuaishou': 'å¿«æ‰‹å¹³å°',
                    'qq': 'QQç¾¤/ç©ºé—´'
                };
                
                // å¦‚æœæ˜¯è‹±æ–‡keyï¼Œè½¬æ¢ä¸ºä¸­æ–‡
                if (channelMap[channel]) {
                    return channelMap[channel];
                }
                
                // å¦åˆ™ç›´æ¥è¿”å›ï¼ˆåº”è¯¥æ˜¯ä¸­æ–‡ï¼‰
                return channel;
            }
            return 'æœªè®¾ç½®';
        }
        
        // ğŸ”§ ä¿®å¤ï¼šè·å–ç±»åˆ«æ–‡æœ¬ - ç›´æ¥è¿”å›ç”¨æˆ·è¾“å…¥çš„ä¸­æ–‡æ•°æ®
        function getCategoryText(category) {
            // å¦‚æœå·²ç»æ˜¯ä¸­æ–‡ï¼Œç›´æ¥è¿”å›
            if (category && typeof category === 'string') {
                // å¤„ç†å¯èƒ½çš„æ—§ç‰ˆæœ¬è‹±æ–‡keyæ˜ å°„
                const categoryMap = {
                    'study': 'å­¦ä¹ èµ„æº',
                    'entertainment': 'å¨±ä¹å†…å®¹'
                };
                
                // å¦‚æœæ˜¯è‹±æ–‡keyï¼Œè½¬æ¢ä¸ºä¸­æ–‡
                if (categoryMap[category]) {
                    return categoryMap[category];
                }
                
                // å¦åˆ™ç›´æ¥è¿”å›ï¼ˆåº”è¯¥æ˜¯ä¸­æ–‡ï¼‰
                return category;
            }
            return 'æœªè®¾ç½®';
        }
        
        // ğŸ”§ ä¿®å¤ï¼šè·å–ç»éªŒæ–‡æœ¬ - ç›´æ¥è¿”å›ç”¨æˆ·è¾“å…¥çš„ä¸­æ–‡æ•°æ®
        function getExperienceText(experience) {
            // å¦‚æœå·²ç»æ˜¯ä¸­æ–‡ï¼Œç›´æ¥è¿”å›
            if (experience && typeof experience === 'string') {
                // å¤„ç†å¯èƒ½çš„æ—§ç‰ˆæœ¬è‹±æ–‡keyæ˜ å°„
                const experienceMap = {
                    'experienced': 'æˆ‘å¾ˆæœ‰ç»éªŒ',
                    'learning': 'æ­£åœ¨å­¦ä¹ ä¸­'
                };
                
                // å¦‚æœæ˜¯è‹±æ–‡keyï¼Œè½¬æ¢ä¸ºä¸­æ–‡
                if (experienceMap[experience]) {
                    return experienceMap[experience];
                }
                
                // å¦åˆ™ç›´æ¥è¿”å›ï¼ˆåº”è¯¥æ˜¯ä¸­æ–‡ï¼‰
                return experience;
            }
            return 'æœªè®¾ç½®';
        }
        
        // è·å–å¤´åƒæ–‡å­—
        function getAvatarText(username) {
            if (!username) return 'U';
            return username.charAt(0).toUpperCase();
        }
        
        // æ ¼å¼åŒ–æ—¶é—´
        function formatTime(timeString) {
            if (!timeString) return 'åˆšåˆš';
            try {
                const date = new Date(timeString);
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) return 'åˆšåˆš';
                if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
                if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
                if (diff < 2592000000) return Math.floor(diff / 86400000) + 'å¤©å‰';
                
                return date.toLocaleDateString('zh-CN');
            } catch (error) {
                return timeString;
            }
        }
        
        // è·å–æ“ä½œæŒ‰é’®
        function getActionButtons(keyword) {
            const status = keyword.status || 'pending';
            
            let buttons = '';
            
            if (status === 'passed') {
                buttons += `
                    <button class="action-btn btn-primary" onclick="copyKeyword('${keyword.keyword || ''}')">
                        <i class="fas fa-copy"></i>
                        å¤åˆ¶å…³é”®è¯
                    </button>
                `;
            } else if (status === 'rejected') {
                buttons += `
                    <button class="action-btn btn-primary" onclick="reapplyKeyword('${keyword.id}')">
                        <i class="fas fa-redo"></i>
                        é‡æ–°ç”³è¯·
                    </button>
                `;
            } else {
                buttons = '';
            }
            // å›å¡«ä¸å›å¡«è®°å½•ï¼ˆä»…æ‚Ÿç©ºæœç´¢ä¸”å®¡æ ¸é€šè¿‡æ˜¾ç¤ºï¼‰
            if ((status === 'approved' || status === 'passed' || status === 'å·²é€šè¿‡') && appState.sourceTask === 'wk') {
                buttons += `
                    <button class="action-btn btn-primary" onclick="openFeedbackModal('${keyword.id||''}')">
                        <i class="fas fa-edit"></i>
                        å›å¡«
                    </button>
                    <button class="action-btn btn-secondary" onclick="viewFeedbackHistory('${keyword.id||''}')">
                        <i class="fas fa-list"></i>
                        å›å¡«è®°å½•
                    </button>
                `;
            }
            
            return buttons;
        }
        
        // ç­›é€‰å…³é”®è¯
        function filterKeywords(filter, element) {
            // æ›´æ–°å½“å‰ç­›é€‰çŠ¶æ€
            appState.currentFilter = filter;
            
            // æ›´æ–°ç»Ÿè®¡å¡ç‰‡æ ·å¼
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('active');
            });
            element.classList.add('active');
            
            // é‡æ–°æ¸²æŸ“åˆ—è¡¨
            renderKeywords(appState.keywords);
            
            // è§¦æ„Ÿåé¦ˆ
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
        }
        
        // è®¾ç½®æœç´¢ç›‘å¬
        // æœç´¢åŒºåŸŸå·²ç§»é™¤ï¼Œä¿ç•™ç©ºå®ç°é¿å…æŠ¥é”™
        function setupSearch() {}
        
        // æ¸…é™¤æœç´¢
        function clearSearch() { appState.searchQuery = ''; }
        
        // æ¸…é™¤ç­›é€‰
        function clearFilters() {
            appState.currentFilter = 'all';
            appState.searchQuery = '';
            
            document.getElementById('searchInput').value = '';
            document.getElementById('clearBtn').style.display = 'none';
            
            document.querySelectorAll('.stat-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector('[data-filter="all"]').classList.add('active');
            
            renderKeywords(appState.keywords);
        }
        
        // ğŸ”§ ä¿®å¤ï¼šåˆ·æ–°æ•°æ®ï¼Œå¼ºåˆ¶ä»æ•°æ®åº“é‡æ–°åŠ è½½
        async function refreshData() {
            document.querySelector('.navbar .action-btn i.fa-sync-alt').style.animation = 'spin 1s linear infinite';
            
            try {
                console.log('ğŸ”„ æ‰‹åŠ¨åˆ·æ–°æ•°æ®ï¼Œå¼ºåˆ¶ä»æ•°æ®åº“åŠ è½½...');
                await loadKeywords();
                showToast('æ•°æ®åˆ·æ–°æˆåŠŸ', 'success');
            } catch (error) {
                console.error('åˆ·æ–°æ•°æ®å¤±è´¥:', error);
                showToast('åˆ·æ–°å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            } finally {
                document.querySelector('.navbar .action-btn i.fa-sync-alt').style.animation = '';
            }
        }
        
        // ğŸ”§ æ–°å¢ï¼šè®¾ç½®è‡ªåŠ¨åˆ·æ–°ï¼Œå®šæœŸä»æ•°æ®åº“åŒæ­¥æœ€æ–°çŠ¶æ€
        function setupAutoRefresh() {
            console.log('â° è®¾ç½®è‡ªåŠ¨æ•°æ®åŒæ­¥...');
            
            // æ¯60ç§’è‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡æ•°æ®
            setInterval(async () => {
                try {
                    console.log('ğŸ”„ è‡ªåŠ¨åŒæ­¥æ•°æ®åº“çŠ¶æ€...');
                    await loadKeywords();
                } catch (error) {
                    console.warn('è‡ªåŠ¨åˆ·æ–°å¤±è´¥:', error);
                }
            }, 60000);
            
            // é¡µé¢è·å¾—ç„¦ç‚¹æ—¶åˆ·æ–°
            window.addEventListener('focus', () => {
                console.log('ğŸ”„ é¡µé¢è·å¾—ç„¦ç‚¹ï¼Œåˆ·æ–°æ•°æ®...');
                setTimeout(() => {
                    loadKeywords();
                }, 1000);
            });
            
            console.log('âœ… è‡ªåŠ¨æ•°æ®åŒæ­¥å·²è®¾ç½®');
        }
        
        // æ·»åŠ æ–°å…³é”®è¯
        function addNewKeyword() {
            if (navigator.vibrate) {
                navigator.vibrate(100);
            }
            // æ ¹æ®å½“å‰è§†å›¾è·³è½¬åˆ°å¯¹åº”ä»»åŠ¡çš„ç”³è¯·é¡µ
            const target = (appState.sourceTask === 'xray') ? 'xray-search-keywords.html' : 'quark-search-keywords.html';
            window.location.href = target;
        }
        
        // å¤åˆ¶å…³é”®è¯
        function copyKeyword(keyword, button) {
            if (!keyword) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å…³é”®è¯', 'error');
                return;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            if (button) {
                const originalHtml = button.innerHTML;
                button.classList.add('copied');
                button.innerHTML = '<i class="fas fa-check"></i>';
                button.disabled = true;
                
                // 2ç§’åæ¢å¤æŒ‰é’®çŠ¶æ€
                setTimeout(() => {
                    button.classList.remove('copied');
                    button.innerHTML = originalHtml;
                    button.disabled = false;
                }, 2000);
            }
            
            try {
                navigator.clipboard.writeText(keyword).then(() => {
                    showToast('å…³é”®è¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                    if (navigator.vibrate) {
                        navigator.vibrate(50);
                    }
                }).catch(() => {
                    // å¦‚æœ clipboard API å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ
                    fallbackCopy(keyword);
                });
            } catch (error) {
                // é™çº§æ–¹æ¡ˆ
                fallbackCopy(keyword);
            }
        }
        
        // é™çº§å¤åˆ¶æ–¹æ¡ˆ
        function fallbackCopy(keyword) {
            try {
                const textArea = document.createElement('textarea');
                textArea.value = keyword;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                textArea.setSelectionRange(0, 99999); // å¯¹ç§»åŠ¨ç«¯å…¼å®¹
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showToast('å…³é”®è¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            } catch (error) {
                console.error('å¤åˆ¶å¤±è´¥:', error);
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¹¶å¤åˆ¶', 'error');
            }
        }
        
        // é‡æ–°ç”³è¯·
        function reapplyKeyword(keywordId) {
            const keyword = appState.keywords.find(k => k.id === keywordId);
            if (!keyword) {
                showToast('æ‰¾ä¸åˆ°è¯¥å…³é”®è¯ä¿¡æ¯', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦é‡æ–°ç”³è¯·è¿™ä¸ªå…³é”®è¯å—ï¼Ÿ')) {
                // é‡æ–°è·³è½¬åˆ°å¯¹åº”ä»»åŠ¡çš„ç”³è¯·é¡µé¢
                const isXray = keyword.task_type === 'xé›·æµè§ˆå™¨æœç´¢ä»»åŠ¡' || appState.sourceTask === 'xray';
                window.location.href = isXray ? 'xray-search-keywords.html' : 'quark-search-keywords.html';
            }
        }
        
        // å·²ç§»é™¤ æŸ¥çœ‹è¯¦æƒ… ä¸ å–æ¶ˆç”³è¯· åŠŸèƒ½
        
        // æ˜¾ç¤ºè®¾ç½®
        function showSettings() {
            showToast('è®¾ç½®åŠŸèƒ½å¼€å‘ä¸­', 'info');
        }
        
        // è¿”å›åŠŸèƒ½
        function goBack() {
            if (navigator.vibrate) {
                navigator.vibrate(50);
            }
            
            if (document.referrer) {
                history.back();
            } else {
                window.location.href = 'index.html';
            }
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const bgColor = {
                'success': '#10b981',
                'error': '#ef4444',
                'info': '#374151'
            }[type] || '#374151';
            
            toast.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: ${bgColor};
                color: white;
                padding: 12px 24px;
                border-radius: 12px;
                font-size: 14px;
                font-weight: 500;
                z-index: 1000;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
                opacity: 0;
                transition: opacity 0.3s ease;
            `;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            requestAnimationFrame(() => {
                toast.style.opacity = '1';
            });
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
        
        // æ˜¾ç¤ºé”™è¯¯
        function showError(message) {
            const container = document.getElementById('keywordsContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                    <h3 style="color: #ef4444;">åŠ è½½å¤±è´¥</h3>
                    <p>${message}</p>
                    <button class="btn-primary action-btn" onclick="refreshData()" style="padding: 12px 24px; font-size: 16px;">
                        <i class="fas fa-sync-alt"></i>
                        é‡æ–°åŠ è½½
                    </button>
                </div>
            `;
        }
    </script>
    
    <!-- å›å¡«ä¿¡æ¯æ¨¡æ€æ¡† -->
    <div id="feedbackModal" class="modal" style="display:none;">
        <div class="modal-content fullscreen">
            <div class="modal-header gradient">
                <div>
                    <div class="modal-title"><i class="fas fa-edit"></i> å…³é”®è¯å›å¡«</div>
                    <div class="modal-sub">è¯·æŒ‰è¦æ±‚å®Œå–„ä¿¡æ¯ï¼Œä¾¿äºå®¡æ ¸å¿«é€Ÿé€šè¿‡</div>
            </div>
                <button class="close-btn" onclick="closeFeedbackModal()" style="color:#fff">&times;</button>
            </div>
            <div class="modal-body fill">
                <div class="form-shell content-grid">
                    <div class="form-card">
                        <div class="form-grid">
                            <div class="form-group span-2">
                                <label class="form-label">å…³é”®è¯</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-key input-icon"></i>
                                    <input id="fb_keyword" class="form-input" placeholder="è¯·è¾“å…¥å…³é”®è¯">
            </div>
                                <div class="hint">ç¤ºä¾‹ï¼š11ã€å“ç‰Œè¯ã€ä½œå“æ ‡é¢˜ä¸­çš„æ ¸å¿ƒè¯ç­‰</div>
            </div>
                            <div class="form-group span-2">
                                <label class="form-label">é“¾æ¥åœ°å€</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-link input-icon"></i>
                                    <input id="fb_link" class="form-input" placeholder="è¯·è¾“å…¥é“¾æ¥">
        </div>
                                <div class="hint">è¯·ç²˜è´´ä½œå“/å•†å“/å¸–å­é“¾æ¥æˆ–æ”¶å½•é“¾æ¥</div>
    </div>
    
    <!-- å›å¡«è®°å½•æ¨¡æ€æ¡† -->
    <div id="feedbackHistoryModal" class="modal" style="display:none;">
        <div class="modal-content" style="max-width:680px;width:92%;">
            <div class="modal-header gradient">
                <div>
                    <div class="modal-title"><i class="fas fa-list"></i> æˆ‘çš„å›å¡«è®°å½•</div>
                    <div class="modal-sub">ä»…å±•ç¤ºå½“å‰ç”³è¯·çš„å†å²å›å¡«</div>
                </div>
                <button class="close-btn" onclick="closeFeedbackHistoryModal()" style="color:#fff">&times;</button>
            </div>
            <div class="modal-body" style="max-height:70vh;overflow:auto;">
                <table style="width:100%;border-collapse:collapse;">
                    <thead>
                        <tr style="background:#f3f4f6;">
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">æ—¶é—´</th>
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">å…³é”®è¯</th>
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">å¹³å°</th>
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">æ–¹å¼</th>
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">é“¾æ¥</th>
                            <th style="text-align:left;padding:8px 10px;border:1px solid #e5e7eb;">æ˜µç§°</th>
                        </tr>
                    </thead>
                    <tbody id="feedbackHistoryBody">
                        <tr><td colspan="6" style="text-align:center;color:#6b7280;padding:16px;">æš‚æ— è®°å½•</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeFeedbackHistoryModal()">å…³é—­</button>
            </div>
        </div>
    </div>
                            <div class="form-group">
                                <label class="form-label">å¹³å°åç§°</label>
                                <div class="input-with-icon select-field" id="cs-platform">
                                    <i class="fas fa-globe input-icon"></i>
                                    <select id="fb_platform" class="form-input" style="appearance:none;">
                                        <option value="æŠ–éŸ³">æŠ–éŸ³</option>
                                        <option value="å¿«æ‰‹">å¿«æ‰‹</option>
                                        <option value="æ‹¼å¤šå¤š">æ‹¼å¤šå¤š</option>
                                        <option value="æ·˜å®">æ·˜å®</option>
                                        <option value="é—²é±¼">é—²é±¼</option>
                                        <option value="ç½‘ç«™">ç½‘ç«™</option>
                                    </select>
                                    <div class="cs-display">æŠ–éŸ³</div>
                                    <div class="dropdown-proxy">
                                        <svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
        </div>
                                    <div class="cs-options"><ul>
                                        <li data-val="æŠ–éŸ³">æŠ–éŸ³</li>
                                        <li data-val="å¿«æ‰‹">å¿«æ‰‹</li>
                                        <li data-val="æ‹¼å¤šå¤š">æ‹¼å¤šå¤š</li>
                                        <li data-val="æ·˜å®">æ·˜å®</li>
                                        <li data-val="é—²é±¼">é—²é±¼</li>
                                        <li data-val="ç½‘ç«™">ç½‘ç«™</li>
                                    </ul></div>
        </div>
                                <div class="hint">ä»ä¸‹æ‹‰é€‰æ‹©ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥</div>
    </div>
                            <div class="form-group">
                                <label class="form-label">æ¨å¹¿æ–¹å¼</label>
                                <div class="input-with-icon select-field" id="cs-method">
                                    <i class="fas fa-bullhorn input-icon"></i>
                                    <select id="fb_method" class="form-input" style="appearance:none;">
                                        <option value="æˆªæµ">æˆªæµ</option>
                                        <option value="çŸ­è§†é¢‘">çŸ­è§†é¢‘</option>
                                        <option value="å›¾æ–‡">å›¾æ–‡</option>
                                        <option value="ç›´æ’­">ç›´æ’­</option>
                                        <option value="å…¶ä»–">å…¶ä»–</option>
                                    </select>
                                    <div class="cs-display">æˆªæµ</div>
                                    <div class="dropdown-proxy">
                                        <svg viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z"/></svg>
                    </div>
                                    <div class="cs-options"><ul>
                                        <li data-val="æˆªæµ">æˆªæµ</li>
                                        <li data-val="çŸ­è§†é¢‘">çŸ­è§†é¢‘</li>
                                        <li data-val="å›¾æ–‡">å›¾æ–‡</li>
                                        <li data-val="ç›´æ’­">ç›´æ’­</li>
                                        <li data-val="å…¶ä»–">å…¶ä»–</li>
                                    </ul></div>
                    </div>
                                <div class="hint">ä»ä¸‹æ‹‰é€‰æ‹©ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥</div>
                </div>
                            <div class="form-group span-2">
                                <label class="form-label">è´¦å·æ˜µç§°ï¼ˆç”¨äºåå°è¯†åˆ«ï¼‰</label>
                                <div class="input-with-icon">
                                    <i class="fas fa-user input-icon"></i>
                                    <input id="fb_nickname" class="form-input" placeholder="è¯·è¾“å…¥ä½ çš„è´¦å·æ˜µç§°">
            </div>
    </div>
            </div>
        </div>
        
                            </div>
                            </div>
            <div class="action-bar">
                <button class="btn" onclick="closeFeedbackModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="submitFeedback()">æäº¤å›å¡«</button>
                        </div>
                        </div>
                    </div>
                    
    <script>
    let feedbackTargetId = null;
    function openFeedbackModal(appId){ feedbackTargetId = appId; document.getElementById('feedbackModal').style.display='flex'; }
    function closeFeedbackModal(){ document.getElementById('feedbackModal').style.display='none'; feedbackTargetId=null; }
    function viewFeedbackHistory(appId){ try{ window.location.href = 'feedback-history.html?id='+encodeURIComponent(appId); }catch(_){}}
    function openFeedbackHistoryModal(appId){ try{ renderFeedbackHistory(appId); document.getElementById('feedbackHistoryModal').style.display='flex'; }catch(e){ console.error(e); }}
    function closeFeedbackHistoryModal(){ try{ document.getElementById('feedbackHistoryModal').style.display='none'; }catch(_){}}

    function renderFeedbackHistory(appId){
        try{
            const body = document.getElementById('feedbackHistoryBody');
            if(!body) return;
            const userId = (appState.currentUser && appState.currentUser.id) || '555';
            // ä¼˜å…ˆä» localStorage å½“å‰ç”¨æˆ·çš„ keywords åˆ—è¡¨è¯»å–
            let records = [];
            try{
                const userKey = 'keywords_'+userId;
                const list = JSON.parse(localStorage.getItem(userKey)||'[]');
                const it = list.find(x=> String(x.id||'')===String(appId));
                if(it){
                    if(Array.isArray(it.user_feedback)) records = it.user_feedback.slice();
                    else if(it.user_feedback) records = [it.user_feedback];
                }
            }catch(_){ }
            // å…œåº•ï¼šä»å…¨å±€ promotionApplications è¯»å–
            if(!records || records.length===0){
                try{
                    const gl = JSON.parse(localStorage.getItem('promotionApplications')||'[]');
                    const it = gl.find(x=> String(x.id||'')===String(appId));
                    if(it){
                        if(Array.isArray(it.user_feedback)) records = it.user_feedback.slice();
                        else if(it.user_feedback) records = [it.user_feedback];
                    }
                }catch(_){ }
            }
            if(!records || records.length===0){
                body.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#6b7280;padding:16px;">æš‚æ— è®°å½•</td></tr>';
                return;
            }
            const esc = s => String(s==null?'':s).replace(/[&<>]/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;' }[m]));
            const rows = records.map(r=>{
                const t = r.time || r.created_at || '-';
                return `<tr>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;white-space:nowrap;">${esc(formatTime(t))}</td>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;">${esc(r.keyword||'-')}</td>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;">${esc(r.platform||'-')}</td>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;">${esc(r.method||'-')}</td>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;max-width:220px;word-break:break-all;">${esc(r.link||'-')}</td>
                    <td style="padding:8px 10px;border:1px solid #e5e7eb;">${esc(r.nickname||'-')}</td>
                </tr>`;
            }).join('');
            body.innerHTML = rows;
        }catch(e){ console.error('renderFeedbackHistory error', e); }
    }
    async function submitFeedback(){
        try{
            const kw = (document.getElementById('fb_keyword')?.value||'').trim();
            const link = (document.getElementById('fb_link')?.value||'').trim();
            const platform = (document.getElementById('fb_platform')?.value||'').trim();
            const method = (document.getElementById('fb_method')?.value||'').trim();
            const nick = (document.getElementById('fb_nickname')?.value||'').trim();
            if(!kw||!link||!platform||!method||!nick){ alert('è¯·å®Œæ•´å¡«å†™æ‰€æœ‰å›å¡«é¡¹'); return; }
            const fbRecord = { time:new Date().toISOString(), keyword:kw, link, platform, method, nickname:nick };
            
            // æœ¬åœ°ç¼“å­˜æ›´æ–°
            try{
                const userId = appState.currentUser.id;
                const key = 'keywords_'+userId;
                const list = JSON.parse(localStorage.getItem(key)||'[]');
                const idx = list.findIndex(x=>String(x.id||'')===String(feedbackTargetId));
                if(idx>-1){
                    const cur = list[idx];
                    if(!Array.isArray(cur.user_feedback)) cur.user_feedback = [];
                    cur.user_feedback.unshift(fbRecord);
                    localStorage.setItem(key, JSON.stringify(list));
                }
            }catch(_){ }
            
            // å…¨å±€åˆ—è¡¨åŒæ­¥ï¼ˆåå°ä»è¿™é‡Œè¯»å–ï¼‰
            try{
                const globalKey='promotionApplications';
                const gl=JSON.parse(localStorage.getItem(globalKey)||'[]');
                const gIdx = gl.findIndex(x=>String(x.id||'')===String(feedbackTargetId));
                if(gIdx>-1){
                    if(!Array.isArray(gl[gIdx].user_feedback)) gl[gIdx].user_feedback = [];
                    gl[gIdx].user_feedback.unshift(fbRecord);
                    localStorage.setItem(globalKey, JSON.stringify(gl));
                }
            }catch(_){ }
            
            // è¿œç«¯å†™å…¥ï¼ˆå…ˆè¯»å–å†è¿½åŠ ï¼Œé¿å…è¦†ç›–ï¼›è‹¥åˆ—ä¸å­˜åœ¨åˆ™è·³è¿‡ä¸”ä¸æŠ¥é”™ï¼‰
            try{
                if(supabase){
                    // å®‰å…¨æ¢æµ‹ï¼šä¸æŒ‡å®šåˆ—ï¼Œæ‹¿ä¸€è¡Œæ ·æœ¬åˆ¤æ–­æ˜¯å¦å­˜åœ¨ user_feedback åˆ—
                    let hasColumn = false;
                    try{
                        const { data: probe } = await supabase
                            .from('keyword_applications')
                            .select('*')
                            .limit(1);
                        if(Array.isArray(probe) && probe.length>0){
                            hasColumn = Object.prototype.hasOwnProperty.call(probe[0], 'user_feedback');
                        }
                    }catch(_){ hasColumn = false; }
                    if(hasColumn){
                        const { data: existing, error: selErr } = await supabase
                            .from('keyword_applications')
                            .select('user_feedback')
                            .eq('id', feedbackTargetId)
                            .single();
                        if(!selErr){
                            const feedbackArr = Array.isArray(existing?.user_feedback) ? existing.user_feedback.slice() : [];
                            feedbackArr.unshift(fbRecord);
                            const { error } = await supabase
                                .from('keyword_applications')
                                .update({ user_feedback: feedbackArr })
                                .eq('id', feedbackTargetId);
                            if(error){ console.warn('æ•°æ®åº“å†™å…¥å¤±è´¥ï¼Œä»…ä¿å­˜åˆ°æœ¬åœ°:', error); }
                            else { console.log('âœ… å›å¡«å†™å…¥æ•°æ®åº“'); }
                        }
                    }else{
                        console.log('user_feedback åˆ—ä¸å­˜åœ¨ï¼Œå·²è·³è¿‡è¿œç«¯å†™å…¥');
                    }
                }
            }catch(e){ console.warn('è¿œç«¯å†™å…¥å¤±è´¥ï¼Œä»…ä¿å­˜åˆ°æœ¬åœ°:', e); }
            
            alert('å›å¡«æäº¤æˆåŠŸ'); closeFeedbackModal();
        }catch(e){ alert('æäº¤å¤±è´¥ï¼Œè¯·é‡è¯•'); console.error(e); }
    }
    // é¢„è§ˆè”åŠ¨
    (function(){
        try{
            const selP=document.getElementById('fb_platform'); const selM=document.getElementById('fb_method'); const nn=document.getElementById('fb_nickname');
            const sync=()=>{
                const get =(id,val)=>{ const el=document.getElementById(id); if(el) el.textContent = val||'-'; };
                if(selP) get('prv_platform', selP.value);
                if(selM) get('prv_method', selM.value);
                if(nn) get('prv_nickname', nn.value.trim());
            };
            if(selP) selP.addEventListener('change', sync);
            if(selM) selM.addEventListener('change', sync);
            if(nn) nn.addEventListener('input', sync);
            sync();
        }catch(_){ }
    })();

    // è‡ªå®šä¹‰é€‰æ‹©æ¡†äº¤äº’ï¼ˆå¸¦ä¸‹æ»‘åŠ¨ç”»ï¼‰
    (function(){
        function bindCustomSelect(wrapperId, hiddenSelectId){
            const wrap = document.getElementById(wrapperId); if(!wrap) return;
            const display = wrap.querySelector('.cs-display');
            const options = wrap.querySelector('.cs-options');
            const items = options.querySelectorAll('li');
            const hidden = document.getElementById(hiddenSelectId);

            function open(){ wrap.classList.add('cs-open'); }
            function close(){ wrap.classList.remove('cs-open'); }
            function toggle(){ wrap.classList.toggle('cs-open'); }
            function choose(val){ if(display){ display.textContent = val; } if(hidden){ hidden.value = val; hidden.dispatchEvent(new Event('change')); } close(); }

            display.addEventListener('click', toggle);
            wrap.querySelector('.dropdown-proxy').addEventListener('click', toggle);
            items.forEach(li=> li.addEventListener('click', ()=> choose(li.getAttribute('data-val'))));
            document.addEventListener('click', (e)=>{ if(!wrap.contains(e.target)) close(); });
        }
        bindCustomSelect('cs-platform','fb_platform');
        bindCustomSelect('cs-method','fb_method');
    })();
    </script>
    
    <!-- ğŸ—‘ï¸ ç´«è‰²åŒºåŸŸçš„é™æ€å…³é”®è¯åˆ—è¡¨å·²å®Œå…¨åˆ é™¤ -->
</body>
</html>