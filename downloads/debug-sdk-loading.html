<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDKåŠ è½½è°ƒè¯•å·¥å…·</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .log { background: #000; color: #0f0; padding: 15px; border-radius: 5px; margin: 10px 0; max-height: 400px; overflow-y: auto; }
        .btn { background: #007bff; color: white; border: none; padding: 10px 15px; margin: 5px; border-radius: 3px; cursor: pointer; }
        .error { color: #f00; }
        .success { color: #0a0; }
        .warning { color: #fa0; }
    </style>
</head>
<body>
    <h1>ğŸ” Supabase SDKåŠ è½½è°ƒè¯•å·¥å…·</h1>
    <button class="btn" onclick="testMethod1()">æµ‹è¯•æ–¹æ³•1: ç›´æ¥CDNåŠ è½½</button>
    <button class="btn" onclick="testMethod2()">æµ‹è¯•æ–¹æ³•2: ä½¿ç”¨loader.js</button>
    <button class="btn" onclick="testMethod3()">æµ‹è¯•æ–¹æ³•3: å¤‡ç”¨CDN</button>
    <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
    
    <div id="log" class="log"></div>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // æ–¹æ³•1: ç›´æ¥CDNåŠ è½½
        async function testMethod1() {
            log('ğŸ”¥ æ–¹æ³•1: ç›´æ¥ä»CDNåŠ è½½Supabase SDK', 'info');
            
            try {
                // ç§»é™¤ç°æœ‰script
                const existingScript = document.querySelector('script[src*="supabase"]');
                if (existingScript) {
                    existingScript.remove();
                    log('ç§»é™¤ç°æœ‰Supabaseè„šæœ¬', 'info');
                }
                
                // æ¸…é™¤å…¨å±€å˜é‡
                delete window.supabase;
                
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js';
                script.async = false; // åŒæ­¥åŠ è½½
                
                script.onload = function() {
                    log('âœ… CDNè„šæœ¬åŠ è½½æˆåŠŸ', 'success');
                    if (window.supabase) {
                        log('âœ… window.supabase å¯ç”¨', 'success');
                        if (typeof window.supabase.createClient === 'function') {
                            log('âœ… createClient å‡½æ•°å¯ç”¨', 'success');
                            testConnection();
                        } else {
                            log('âŒ createClient å‡½æ•°ä¸å¯ç”¨', 'error');
                        }
                    } else {
                        log('âŒ window.supabase ä¸å¯ç”¨', 'error');
                    }
                };
                
                script.onerror = function() {
                    log('âŒ CDNè„šæœ¬åŠ è½½å¤±è´¥', 'error');
                };
                
                document.head.appendChild(script);
                log('å¼€å§‹åŠ è½½CDNè„šæœ¬...', 'info');
                
            } catch (error) {
                log(`âŒ æ–¹æ³•1å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ–¹æ³•2: ä½¿ç”¨ç°æœ‰loader.js
        async function testMethod2() {
            log('ğŸ”¥ æ–¹æ³•2: ä½¿ç”¨supabase-loader.js', 'info');
            
            try {
                if (typeof window.ensureSupabaseLoaded === 'function') {
                    log('âœ… ensureSupabaseLoaded å‡½æ•°å¯ç”¨', 'success');
                    await window.ensureSupabaseLoaded();
                    log('âœ… ensureSupabaseLoaded æ‰§è¡Œå®Œæˆ', 'success');
                    
                    if (window.supabase && typeof window.supabase.createClient === 'function') {
                        log('âœ… Supabase SDKåŠ è½½æˆåŠŸ', 'success');
                        testConnection();
                    } else {
                        log('âŒ Supabase SDKåŠ è½½å¤±è´¥', 'error');
                    }
                } else {
                    log('âŒ ensureSupabaseLoaded å‡½æ•°ä¸å¯ç”¨', 'error');
                    log('å°è¯•ç›´æ¥åŠ è½½ supabase-loader.js...', 'info');
                    
                    const script = document.createElement('script');
                    script.src = 'supabase-loader.js';
                    script.onload = () => {
                        log('âœ… supabase-loader.js åŠ è½½æˆåŠŸ', 'success');
                        setTimeout(() => testMethod2(), 1000); // é‡è¯•
                    };
                    script.onerror = () => {
                        log('âŒ supabase-loader.js åŠ è½½å¤±è´¥', 'error');
                    };
                    document.head.appendChild(script);
                }
            } catch (error) {
                log(`âŒ æ–¹æ³•2å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ–¹æ³•3: å¤‡ç”¨CDN
        async function testMethod3() {
            log('ğŸ”¥ æ–¹æ³•3: ä½¿ç”¨å¤‡ç”¨CDN', 'info');
            
            const cdnUrls = [
                'https://unpkg.com/@supabase/supabase-js@2/dist/umd/supabase.js',
                'https://cdn.skypack.dev/@supabase/supabase-js@2',
                'https://esm.sh/@supabase/supabase-js@2'
            ];
            
            for (const url of cdnUrls) {
                try {
                    log(`å°è¯•åŠ è½½: ${url}`, 'info');
                    
                    // ç§»é™¤ç°æœ‰script
                    const existingScript = document.querySelector('script[src*="supabase"]');
                    if (existingScript) existingScript.remove();
                    delete window.supabase;
                    
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = url;
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                    
                    if (window.supabase && typeof window.supabase.createClient === 'function') {
                        log(`âœ… æˆåŠŸä»å¤‡ç”¨CDNåŠ è½½: ${url}`, 'success');
                        testConnection();
                        return;
                    } else {
                        log(`âŒ ä» ${url} åŠ è½½å¤±è´¥`, 'error');
                    }
                    
                } catch (error) {
                    log(`âŒ ${url} åŠ è½½é”™è¯¯: ${error.message}`, 'error');
                }
            }
            
            log('âŒ æ‰€æœ‰å¤‡ç”¨CDNéƒ½å¤±è´¥', 'error');
        }

        // æµ‹è¯•æ•°æ®åº“è¿æ¥
        async function testConnection() {
            log('ğŸ”— æµ‹è¯•æ•°æ®åº“è¿æ¥...', 'info');
            
            try {
                const SUPABASE_URL = 'https://ybrveusbwjusnrzgfnok.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlicnZldXNid2p1c25yemdmbm9rIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY0ODU1NjIsImV4cCI6MjA3MjA2MTU2Mn0.JKPSUli-q9wRuDagE6kwltLk9XgfygE8yznm-Ca82Qk';
                
                log('åˆ›å»ºSupabaseå®¢æˆ·ç«¯...', 'info');
                const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('âœ… Supabaseå®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ', 'success');
                
                log('æµ‹è¯•æ•°æ®åº“æŸ¥è¯¢...', 'info');
                const { data, error } = await client
                    .from('users')
                    .select('id')
                    .limit(1);
                
                if (error) {
                    log(`âš ï¸ æ•°æ®åº“æŸ¥è¯¢æœ‰é”™è¯¯ï¼Œä½†è¿æ¥å¯èƒ½æ­£å¸¸: ${error.message}`, 'warning');
                    if (error.message.includes('relation "users" does not exist')) {
                        log('âœ… è¿æ¥æ­£å¸¸ï¼Œåªæ˜¯ç”¨æˆ·è¡¨ä¸å­˜åœ¨', 'success');
                    }
                } else {
                    log('âœ… æ•°æ®åº“è¿æ¥å’ŒæŸ¥è¯¢éƒ½æˆåŠŸ', 'success');
                }
                
            } catch (error) {
                log(`âŒ æ•°æ®åº“è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰çŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ SDKè°ƒè¯•å·¥å…·å·²å¯åŠ¨', 'info');
            log('å½“å‰ç¯å¢ƒæ£€æŸ¥:', 'info');
            log(`- window.supabase: ${typeof window.supabase}`, window.supabase ? 'success' : 'error');
            log(`- ensureSupabaseLoaded: ${typeof window.ensureSupabaseLoaded}`, typeof window.ensureSupabaseLoaded === 'function' ? 'success' : 'error');
            log(`- ç”¨æˆ·ä»£ç†: ${navigator.userAgent}`, 'info');
            log(`- å½“å‰åŸŸå: ${location.hostname}`, 'info');
        });
    </script>
</body>
</html>







































































